<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>K-Means Clustering with F# | codesuji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The topic for today is leveraging K-Means clustering to perform simple Las Vegas hotel data analysis.  This will be done using F# and Accord.NET.">
<meta name="keywords" content="F#,FSharp,Machine Learning,Analytics,Accord.NET,Statistics">
<meta property="og:type" content="article">
<meta property="og:title" content="K-Means Clustering with F#">
<meta property="og:url" content="http://codesuji.com/2017/08/27/K-Means-Clustering-with-F/index.html">
<meta property="og:site_name" content="codesuji">
<meta property="og:description" content="The topic for today is leveraging K-Means clustering to perform simple Las Vegas hotel data analysis.  This will be done using F# and Accord.NET.">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://codesuji.com/images/km1/ErrorChart.png">
<meta property="og:updated_time" content="2017-12-23T19:03:14.112Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="K-Means Clustering with F#">
<meta name="twitter:description" content="The topic for today is leveraging K-Means clustering to perform simple Las Vegas hotel data analysis.  This will be done using F# and Accord.NET.">
<meta name="twitter:image" content="http://codesuji.com/images/km1/ErrorChart.png">
  
    <link rel="alternate" href="/atom.xml" title="codesuji" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89982547-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">codesuji</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://codesuji.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-K-Means-Clustering-with-F" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/27/K-Means-Clustering-with-F/" class="article-date">
  <time datetime="2017-08-27T09:53:01.000Z" itemprop="datePublished">2017-08-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      K-Means Clustering with F#
    </h1>
  

 		<span class="post-count">Read Time: 13 minutes</span>
 	  </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The topic for today is leveraging K-Means clustering to perform simple Las Vegas hotel data analysis.  This will be done using <a href="http://fsharp.org/" target="_blank" rel="noopener">F#</a> and <a href="http://accord-framework.net/" target="_blank" rel="noopener">Accord.NET</a>.</p>
<a id="more"></a>
<p>K-Means clustering can be a useful tool when performing data analysis, and F# is an obvious tool for some quick transforms and reporting.  This post will use customer satisfaction survey data for several Las Vegas hotels.  I will focus on hotel similarity based on available ammenties.  Based on this similarity I will then compare hotels against their relative counterparts.  The data was obtained from the <a href="https://archive.ics.uci.edu/ml/datasets/Las+Vegas+Strip" target="_blank" rel="noopener">UCI Machine Learning Repository</a>.  This data is from “Stripping customers’ feedback on hotels through data mining: The case of Las Vegas Strip. Tourism Management Perspectives”<sub>[1]</sub>.  If you want to follow along, go out and grab the data.  Now, without further delay.</p>
<p>Using <a href="https://github.com/fsprojects/Paket" target="_blank" rel="noopener">Paket</a>, here is the paket.dependencies file.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">source https:<span class="comment">//nuget.org/api/v2</span></span><br><span class="line">nuget Accord</span><br><span class="line">nuget Accord.MachineLearning</span><br><span class="line">nuget Accord.Math</span><br><span class="line">nuget FSharp.Data</span><br><span class="line">nuget FSharp.Charting</span><br></pre></td></tr></table></figure>
<p>First, setup the libraries and defaults.  <code>k</code> will be the number of clusters, which is 5.  I’ll go into more detail later why that is my magic number.  The datafile is a <code>;</code> delimited file, and the <code>CSVProvider</code> from <code>FSharp.Data</code> makes loading the data easy money. </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">System.IO.Directory.SetCurrentDirectory(__SOURCE_DIRECTORY__)</span><br><span class="line"></span><br><span class="line">#r <span class="string">"../packages/FSharp.Data/lib/net40/FSharp.Data.dll"</span></span><br><span class="line">#r <span class="string">"../packages/FSharp.Charting/lib/net45/FSharp.Charting.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Accord/lib/net45/Accord.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Accord.MachineLearning/lib/net45/Accord.MachineLearning.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Accord.Math/lib/net45/Accord.Math.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Accord.Math/lib/net45/Accord.Math.Core.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Accord.Statistics/lib/net45/Accord.Statistics.dll"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> System</span><br><span class="line"><span class="keyword">open</span> System.IO</span><br><span class="line"><span class="keyword">open</span> FSharp.Data</span><br><span class="line"><span class="keyword">open</span> Accord</span><br><span class="line"><span class="keyword">open</span> Accord.MachineLearning</span><br><span class="line"><span class="keyword">open</span> Accord.Math</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> k = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">[&lt;Literal&gt;]</span></span><br><span class="line"><span class="keyword">let</span> VegasDataFilename = <span class="string">"../data/LasVegasTripAdvisorReviews-Dataset.csv"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">VegasData</span> </span>= CsvProvider&lt;VegasDataFilename, <span class="string">";"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>The data is structured as multiple review instances per hotel.  To get the data in the desired format, some quick transformation steps are required.  For the First step, group data by Hotel into <code>allData</code>.  Second, grab a distinct record for each hotel.  For this I use <code>(snd &gt;&gt; Array.head)</code> to extract the first record from each hotel group.  Third, aggregate each hotel’s specific scores so an average can be calculated into <code>hotelScores</code>.  Finally, grab a list of hotel names for later reporting.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> allData = </span><br><span class="line">  VegasData.Load(VegasDataFilename).Rows</span><br><span class="line">  |&gt; Seq.toArray</span><br><span class="line">  |&gt; Array.groupBy (<span class="keyword">fun</span> x -&gt; x.``Hotel name``)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hotelAmmenities =</span><br><span class="line">  allData </span><br><span class="line">  |&gt; Array.map (snd &gt;&gt; Array.head)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hotelScores = </span><br><span class="line">  allData</span><br><span class="line">  |&gt; Array.map (<span class="keyword">fun</span> (hotelName, rows) -&gt; </span><br><span class="line">    hotelName, </span><br><span class="line">    (rows |&gt; Array.averageBy (<span class="keyword">fun</span> x -&gt; float x.Score)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dataNames = </span><br><span class="line">  hotelAmmenities </span><br><span class="line">  |&gt; Array.map (<span class="keyword">fun</span> row -&gt; row.``Hotel name``)</span><br></pre></td></tr></table></figure>
<p>There is one final transformation.  The Accord.NET K-Means object expects data as an array of arrays of floats.  Here I pull out the ammenities that I care about.  Does it have a pool, gym, tennis court, spa, casino <em>(you can have a hotel in vegas without a casino?)</em>, free internet, and it’s star rating.  From the dataset provided, these are the most interesting.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> boolToFloat x = <span class="keyword">if</span> x <span class="keyword">then</span> <span class="number">1.</span> <span class="keyword">else</span> <span class="number">0.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dataValues = </span><br><span class="line"> hotelAmmenities </span><br><span class="line">  |&gt; Array.map (<span class="keyword">fun</span> row -&gt; </span><br><span class="line">    [|</span><br><span class="line">      boolToFloat row.Pool;</span><br><span class="line">      boolToFloat row.Gym;</span><br><span class="line">      boolToFloat row.``Tennis court``;</span><br><span class="line">      boolToFloat row.Spa;</span><br><span class="line">      boolToFloat row.Casino;</span><br><span class="line">      boolToFloat row.``Free internet``;</span><br><span class="line">      float row.``Hotel stars``</span><br><span class="line">    |]) </span><br></pre></td></tr></table></figure>
<p>Accord.NET makes the calls pretty easy.  Setup a <code>KMeans</code> object with a specified number of clusters, then learn based on the data provided.  Since I’m peforming analysis on existing data, I then obtain the cluster labels for my data.  If the problem was a prediction problem, <code>clusters</code> would be the object I could use elsewhere for predicting what future hotels are similar to existing hotels.  Additionally, the <code>KMeans</code> class provides functionality to evaluate cluster details, such as centroids and error.  I’ll dig into these more toward the end.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> kmeans = KMeans(k)</span><br><span class="line"><span class="keyword">let</span> clusters = kmeans.Learn(dataValues)</span><br><span class="line"><span class="keyword">let</span> labels = clusters.Decide(dataValues)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Model analysis</span></span><br><span class="line">clusters.Centroids</span><br><span class="line">clusters.Clusters</span><br><span class="line">kmeans.Error</span><br></pre></td></tr></table></figure>
<p>Once the cluster labeling is complete I combine my earlier generated <code>hotelScores</code> with the cluster label for each hotel.  Since I kept the data in the same order, it can simply be zipped together as a <code>(&lt;hotelScore&gt;, &lt;cluster #&gt;)</code> tuple. </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> combinedData = </span><br><span class="line">  (hotelScores, labels)</span><br><span class="line">  ||&gt; Array.zip</span><br></pre></td></tr></table></figure>
<p>For comparative analysis, the average hotel review score for each cluster must be obtained.  It is a matter of taking the newly created <code>combinedData</code>, grouping by cluster, then averaging the score of each hotel in the cluster.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> avgClusterScore = </span><br><span class="line"> combinedData </span><br><span class="line">  |&gt; Array.groupBy (<span class="keyword">fun</span> (scores, cluster) -&gt; cluster)</span><br><span class="line">  |&gt; Array.map (<span class="keyword">fun</span> (cluster, scores) -&gt; </span><br><span class="line">    cluster, </span><br><span class="line">    (scores |&gt; Array.map (fst&gt;&gt;snd) |&gt; Array.average)) </span><br><span class="line">  |&gt; Map  </span><br></pre></td></tr></table></figure>
<p>This code deserves a bit of an explanation.  In my defense, this is a small exercise.  In production I try to avoid tuples of tuples of tuples all the way down. This is currently at the border of reasonable readability.  Below is a deeper breakdown into what is going on.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Source</span></span><br><span class="line">combinedData </span><br><span class="line"></span><br><span class="line"><span class="comment">// Groups by cluster</span></span><br><span class="line">|&gt; Array.groupBy (<span class="keyword">fun</span> (scores, cluster) -&gt; cluster)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gives something that looks like this: </span></span><br><span class="line">[|(<span class="number">3</span>,</span><br><span class="line">    [|((<span class="string">"Circus Circus Hotel &amp; Casino Las Vegas"</span>, <span class="number">3.208333333</span>), <span class="number">3</span>);</span><br><span class="line">      ((<span class="string">"Hilton Grand Vacations at the Flamingo"</span>, <span class="number">3.958333333</span>), <span class="number">3</span>)|]);</span><br><span class="line">   (<span class="number">4</span>,</span><br><span class="line">    [|((<span class="string">"Excalibur Hotel &amp; Casino"</span>, <span class="number">3.708333333</span>), <span class="number">4</span>);</span><br><span class="line">      ((<span class="string">"Tuscany Las Vegas Suites &amp; Casino"</span>, <span class="number">4.208333333</span>), <span class="number">4</span>)|]);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates a tuple of (&lt;cluster #&gt;, &lt;average cluster score&gt;)</span></span><br><span class="line">|&gt; Array.map (<span class="keyword">fun</span> (cluster, scores) -&gt; </span><br><span class="line">  <span class="comment">// Cluster #</span></span><br><span class="line">  cluster, </span><br><span class="line">  <span class="comment">// Extracts the score from ((&lt;hotel name&gt;, &lt;score&gt;), &lt;cluster#&gt;) </span></span><br><span class="line">  <span class="comment">// fst&gt;&gt;snd navigates to the first tuple, second item</span></span><br><span class="line">  (scores |&gt; Array.map (fst&gt;&gt;snd) |&gt; Array.average)) </span><br><span class="line"></span><br><span class="line"><span class="comment">// Turns it all into a map so I can do average score lookups based on cluster.</span></span><br><span class="line">|&gt; Map  </span><br></pre></td></tr></table></figure>
<p>Whew, now that is done.  Time to see some results.  The report is sorted by cluster number and hotel score (descending).  </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">printfn <span class="string">"%7s %-55s %5s %s"</span> <span class="string">"Cluster"</span> <span class="string">"Hotel"</span> <span class="string">"Score"</span> <span class="string">"ClusterScore"</span></span><br><span class="line">combinedData</span><br><span class="line">|&gt; Array.sortBy (<span class="keyword">fun</span> (x, cluster) -&gt; cluster, (snd x) * <span class="number">-1.</span>)</span><br><span class="line">|&gt; Array.iter (<span class="keyword">fun</span> (x, cluster ) -&gt; printfn <span class="string">"%7d %-55s  %0.2f         %0.2f"</span> cluster (fst x) (snd x) (avgClusterScore.Item cluster))</span><br></pre></td></tr></table></figure>
<p>Based on relative ammenties (and 5 clusters), here are the results.  With a small bit of code I’ve gone from data file to cluster score hotel comparisons.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Cluster Hotel                                                   Score ClusterScore</span><br><span class="line">      <span class="number">0</span> Wynn Las Vegas                                           <span class="number">4.63</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> The Venetian Las Vegas Hotel                             <span class="number">4.58</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Encore at wynn Las Vegas                                 <span class="number">4.54</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> The Palazzo Resort Hotel Casino                          <span class="number">4.38</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Trump International Hotel Las Vegas                      <span class="number">4.38</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> The Cosmopolitan Las Vegas                               <span class="number">4.25</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Bellagio Las Vegas                                       <span class="number">4.21</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Caesars Palace                                           <span class="number">4.13</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Tropicana Las Vegas - A Double Tree by Hilton Hotel      <span class="number">4.04</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Paris Las Vegas                                          <span class="number">4.04</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Treasure Island- TI Hotel &amp; Casino                       <span class="number">3.96</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> The Westin las Vegas Hotel Casino &amp; Spa                  <span class="number">3.92</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">0</span> Monte Carlo Resort&amp;Casino                                <span class="number">3.29</span>         <span class="number">4.18</span></span><br><span class="line">      <span class="number">1</span> Marriott's Grand Chateau                                 <span class="number">4.54</span>         <span class="number">4.36</span></span><br><span class="line">      <span class="number">1</span> Wyndham Grand Desert                                     <span class="number">4.38</span>         <span class="number">4.36</span></span><br><span class="line">      <span class="number">1</span> Hilton Grand Vacations on the Boulevard                  <span class="number">4.17</span>         <span class="number">4.36</span></span><br><span class="line">      <span class="number">2</span> The Cromwell                                             <span class="number">4.08</span>         <span class="number">4.08</span></span><br><span class="line">      <span class="number">3</span> Hilton Grand Vacations at the Flamingo                   <span class="number">3.96</span>         <span class="number">3.58</span></span><br><span class="line">      <span class="number">3</span> Circus Circus Hotel &amp; Casino Las Vegas                   <span class="number">3.21</span>         <span class="number">3.58</span></span><br><span class="line">      <span class="number">4</span> Tuscany Las Vegas Suites &amp; Casino                        <span class="number">4.21</span>         <span class="number">3.96</span></span><br><span class="line">      <span class="number">4</span> Excalibur Hotel &amp; Casino                                 <span class="number">3.71</span>         <span class="number">3.96</span></span><br></pre></td></tr></table></figure>
<p>I want to backtrack now, and investigate the cluster details.</p>
<p>Where are the centroids for each cluster?</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">clusters.Centroids</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> it : float [] [] =</span><br><span class="line">  [|[|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.2307692308</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.9230769231</span>; <span class="number">4.615384615</span>|];</span><br><span class="line">    [|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.3333333333</span>; <span class="number">0.3333333333</span>; <span class="number">0.6666666667</span>; <span class="number">1.0</span>; <span class="number">35.0</span>|];</span><br><span class="line">    [|<span class="number">1.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">45.0</span>|];</span><br><span class="line">    [|<span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">3.0</span>|];</span><br><span class="line">    [|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">3.0</span>|]|]</span><br></pre></td></tr></table></figure>
<p>What are the cluster details?</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">clusters.Clusters</span><br><span class="line">|&gt; Array.iter(<span class="keyword">fun</span> cluster -&gt;</span><br><span class="line">  printfn <span class="string">"%d %0.2f"</span> cluster.Index cluster.Proportion <span class="comment">// Index and proportion of data</span></span><br><span class="line">  printfn <span class="string">"   %A"</span> cluster.Centroid                    <span class="comment">// Centroids (like above)</span></span><br><span class="line">  printfn <span class="string">"   %A"</span> cluster.Covariance                  <span class="comment">// Covariances  </span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">0.62</span></span><br><span class="line">   [|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.2307692308</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.9230769231</span>; <span class="number">4.615384615</span>|]</span><br><span class="line">   [|[|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; [|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; ...|]</span><br><span class="line"><span class="number">1</span> <span class="number">0.14</span></span><br><span class="line">   [|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.3333333333</span>; <span class="number">0.3333333333</span>; <span class="number">0.6666666667</span>; <span class="number">1.0</span>; <span class="number">35.0</span>|]</span><br><span class="line">   [|[|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; [|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; ...|]</span><br><span class="line"><span class="number">2</span> <span class="number">0.05</span></span><br><span class="line">   [|<span class="number">1.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">45.0</span>|]</span><br><span class="line">   [|[|nan; nan; nan; nan; nan; nan; nan|]; [|nan; nan; nan; nan; nan; nan; nan|]; ...|]</span><br><span class="line"><span class="number">3</span> <span class="number">0.10</span></span><br><span class="line">   [|<span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">3.0</span>|]</span><br><span class="line">   [|[|<span class="number">0.5</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">-0.5</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; [|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; ...]|]</span><br><span class="line"><span class="number">4</span> <span class="number">0.10</span></span><br><span class="line">   [|<span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">0.5</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">1.0</span>; <span class="number">3.0</span>|]</span><br><span class="line">   [|[|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; [|<span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>; <span class="number">0.0</span>|]; ...|]</span><br></pre></td></tr></table></figure>
<p>What is the calculated error?</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kmeans.Error</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> it : float = <span class="number">0.467032967</span></span><br></pre></td></tr></table></figure>
<p>Taking this a little further.  How many clusters should be used?  What are the clustering dynamics?  There are 21 hotels with 7 dimensions.  My gut feeling is somewhere between 3 and 7 clusters probably makes sense.  That should be enough to provide some distinction, but allow for large enough groupings to be useful.  When generating the clusters, the initial centroids are random.  This means the data could be clustered differently depending on starting points.  To test this I’ll look at between 2 and 15 clusters.  I’ll also run 100 trials per cluster size, and average the error score for that cluster.  This should give a reasonable view into the clustering performance.  </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2.</span><span class="number">.15</span>]</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> k -&gt;</span><br><span class="line">  <span class="keyword">let</span> error =</span><br><span class="line">    [<span class="number">0.</span><span class="number">.100</span>]</span><br><span class="line">    |&gt; List.map (<span class="keyword">fun</span> trial -&gt;</span><br><span class="line">      <span class="keyword">let</span> kmeans = <span class="keyword">new</span> KMeans(k)</span><br><span class="line">      <span class="keyword">let</span> clusters = kmeans.Learn(dataValues)</span><br><span class="line">      <span class="keyword">let</span> labels = clusters.Decide(dataValues)</span><br><span class="line">      kmeans.Error)</span><br><span class="line">    |&gt; List.average</span><br><span class="line">  k, error)</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> (k, error) -&gt; </span><br><span class="line">  printfn <span class="string">"%2d %0.2f"</span> k error</span><br><span class="line">  (k,error))</span><br><span class="line">|&gt; Chart.Line</span><br><span class="line">|&gt; Chart.WithXAxis(Title = <span class="string">"Clusters (k)"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Title = <span class="string">"Error"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results</span></span><br><span class="line"> <span class="number">2</span> <span class="number">4.61</span></span><br><span class="line"> <span class="number">3</span> <span class="number">1.62</span></span><br><span class="line"> <span class="number">4</span> <span class="number">0.85</span></span><br><span class="line"> <span class="number">5</span> <span class="number">0.45</span></span><br><span class="line"> <span class="number">6</span> <span class="number">0.35</span></span><br><span class="line"> <span class="number">7</span> <span class="number">0.28</span></span><br><span class="line"> <span class="number">8</span> <span class="number">0.21</span></span><br><span class="line"> <span class="number">9</span> <span class="number">0.17</span></span><br><span class="line"><span class="number">10</span> <span class="number">0.11</span></span><br><span class="line"><span class="number">11</span> <span class="number">0.07</span></span><br><span class="line"><span class="number">12</span> <span class="number">0.03</span></span><br><span class="line"><span class="number">13</span> <span class="number">0.00</span></span><br><span class="line"><span class="number">14</span> <span class="number">0.00</span></span><br><span class="line"><span class="number">15</span> <span class="number">0.00</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/km1/ErrorChart.png" alt="Error Chart"></p>
<p>Looking at the results, error goes down as k goes up.  This makes sense, with only 7 ammenity dimensions, most of them being standard, distinction completely falling off at around 12 clusters.  But that’s not useful.  So I can’t just take the smallest error.  The most dramatic error reduction happens at 4 clusters, but the slope seems to really level off after k=5.  From these results 4 or 5 seem like reasonable bets.  I choose 5 because it provides a bit more separation, and it’s a prime number. :)  </p>
<p>With all this done.  I have a reasonable expectation that I’m clustering properly.  I can now go back to the original report and see how similar hotels compare.  This post has just been one example of how you can use K-Means clustering.  I hope you found it useful.  Until next time…</p>
<p><strong>References</strong><br>[1] ref: Moro, S., Rita, P., &amp; Coelho, J. (2017). Stripping customers’ feedback on hotels through data mining: The case of Las Vegas Strip. Tourism Management Perspectives, 23, 41-52.</p>

        <div class="related-posts-box">
        Related Posts:<ul class="related-posts"><li class="related-posts-item"><a class="related-posts-link" href="/2016/12/07/Decision-Trees-with-F-and-Accord-NET-Part-2/">Decision Trees with F# and Accord.NET (Part 2)</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2016/11/21/Face-Detection-with-FSharp-and-Accord-NET/">Face Detection with F# and Accord.NET</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2018/01/06/Tackling-Kaggle-FSharp-XGBoost/">Tackling Kaggle with F# and XGBoost</a></li></ul>        </div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://codesuji.com/2017/08/27/K-Means-Clustering-with-F/" data-id="cjdxxxwb9000njbm0hhysjl59" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Accord-NET/">Accord.NET</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Analytics/">Analytics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/F/">F#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FSharp/">FSharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Statistics/">Statistics</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/26/The-Power-of-the-Forward-Pipe/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          The Power of the Forward Pipe
        
      </div>
    </a>
  
  
    <a href="/2017/08/20/F-and-Serilog/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">F# and Serilog</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Core/" style="font-size: 10px;">.NET Core</a> <a href="/tags/Accord-NET/" style="font-size: 16.67px;">Accord.NET</a> <a href="/tags/Analytics/" style="font-size: 15px;">Analytics</a> <a href="/tags/Audio/" style="font-size: 10px;">Audio</a> <a href="/tags/Classification/" style="font-size: 11.67px;">Classification</a> <a href="/tags/Cognitive-Services/" style="font-size: 11.67px;">Cognitive Services</a> <a href="/tags/Compiler/" style="font-size: 15px;">Compiler</a> <a href="/tags/Computer-Vision/" style="font-size: 11.67px;">Computer Vision</a> <a href="/tags/DTW/" style="font-size: 11.67px;">DTW</a> <a href="/tags/Data/" style="font-size: 18.33px;">Data</a> <a href="/tags/Database/" style="font-size: 11.67px;">Database</a> <a href="/tags/Decision-Trees/" style="font-size: 11.67px;">Decision Trees</a> <a href="/tags/Deedle/" style="font-size: 10px;">Deedle</a> <a href="/tags/Delegate/" style="font-size: 10px;">Delegate</a> <a href="/tags/Detection/" style="font-size: 10px;">Detection</a> <a href="/tags/Dynamic-Time-Warping/" style="font-size: 11.67px;">Dynamic Time Warping</a> <a href="/tags/EEG/" style="font-size: 10px;">EEG</a> <a href="/tags/Edges/" style="font-size: 10px;">Edges</a> <a href="/tags/EmguCV/" style="font-size: 10px;">EmguCV</a> <a href="/tags/F/" style="font-size: 20px;">F#</a> <a href="/tags/FParsec/" style="font-size: 13.33px;">FParsec</a> <a href="/tags/FSAdvent/" style="font-size: 10px;">FSAdvent</a> <a href="/tags/FSharp/" style="font-size: 20px;">FSharp</a> <a href="/tags/Faces/" style="font-size: 11.67px;">Faces</a> <a href="/tags/Filters/" style="font-size: 10px;">Filters</a> <a href="/tags/Http/" style="font-size: 11.67px;">Http</a> <a href="/tags/Images/" style="font-size: 13.33px;">Images</a> <a href="/tags/Ionide/" style="font-size: 10px;">Ionide</a> <a href="/tags/Kaggle/" style="font-size: 11.67px;">Kaggle</a> <a href="/tags/Legos/" style="font-size: 11.67px;">Legos</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/MSIL/" style="font-size: 13.33px;">MSIL</a> <a href="/tags/Machine-Learning/" style="font-size: 18.33px;">Machine Learning</a> <a href="/tags/MathNet/" style="font-size: 10px;">MathNet</a> <a href="/tags/Mono/" style="font-size: 10px;">Mono</a> <a href="/tags/Morse-Code/" style="font-size: 10px;">Morse Code</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/Parsing/" style="font-size: 13.33px;">Parsing</a> <a href="/tags/Racket/" style="font-size: 10px;">Racket</a> <a href="/tags/Regression/" style="font-size: 10px;">Regression</a> <a href="/tags/Rekognition/" style="font-size: 10px;">Rekognition</a> <a href="/tags/Robotics/" style="font-size: 10px;">Robotics</a> <a href="/tags/Scoring/" style="font-size: 10px;">Scoring</a> <a href="/tags/Signals/" style="font-size: 11.67px;">Signals</a> <a href="/tags/Similarity/" style="font-size: 11.67px;">Similarity</a> <a href="/tags/Sound/" style="font-size: 10px;">Sound</a> <a href="/tags/Statistics/" style="font-size: 15px;">Statistics</a> <a href="/tags/Tail-calls/" style="font-size: 10px;">Tail calls</a> <a href="/tags/Text/" style="font-size: 11.67px;">Text</a> <a href="/tags/Translation/" style="font-size: 10px;">Translation</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Webapi/" style="font-size: 11.67px;">Webapi</a> <a href="/tags/admin/" style="font-size: 11.67px;">admin</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 codesuji.com<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>