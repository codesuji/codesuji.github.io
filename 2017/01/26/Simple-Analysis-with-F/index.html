<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Simple Analysis with F# | codesuji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  At the core, all programs are about processing da">
<meta property="og:type" content="article">
<meta property="og:title" content="Simple Analysis with F#">
<meta property="og:url" content="http://codesuji.com/2017/01/26/Simple-Analysis-with-F/index.html">
<meta property="og:site_name" content="codesuji">
<meta property="og:description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  At the core, all programs are about processing da">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment1.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount1.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment2.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount2.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount_sentiment.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment3.png">
<meta property="og:updated_time" content="2017-01-28T15:43:40.748Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple Analysis with F#">
<meta name="twitter:description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  At the core, all programs are about processing da">
<meta name="twitter:image" content="http://codesuji.com/images/sa1/sentiment1.png">
  
    <link rel="alternate" href="/atom.xml" title="codesuji" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89982547-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">codesuji</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://codesuji.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Simple-Analysis-with-F" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/26/Simple-Analysis-with-F/" class="article-date">
  <time datetime="2017-01-27T03:10:36.000Z" itemprop="datePublished">2017-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Simple Analysis with F#
    </h1>
  

 		<span class="post-count">Read Time: 11 minutes</span>
 	  </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This post is a follow up to my previous look into <a href="/2017/01/20/F-and-Text-Analytics/">Text Analytics</a>.  It will provide additional examples of how data can be pulled and processed in <a href="http://fsharp.org/" target="_blank" rel="external">F#</a>.  At the core, all programs are about processing data.  How that data flows is significant.  It impacts not only technical performance, but developer productivity.  F#’s semantics provides a clean mechanism for data flow.  This leads to a lower cognitive load when parsing intent, so developers can focus on the larger problem.  Honestly, it’s one of the reasons I enjoy the language.  Philosophical ramblings aside, it’s possible I’m just looking for reasons to draw more charts.  For that to happen, I’ll be doing light analysis of the full text of Mary Shelley’s “Frankenstein”.</p>
<a id="more"></a>
<p>Like last time, if you want to follow along, you’ll need to first get a free account from <a href="https://www.microsoft.com/cognitive-services/en-us/" target="_blank" rel="external">Cognitive Services</a>.  Then request the api access you want, for this post it is “Text Analytics”.  The apikey they provide can be used in the upcoming code if you want to make your own calls.  Microsoft offers a nice amount of free calls, providing plenty of room to play in the environment.  </p>
<p>Using <a href="https://github.com/fsprojects/Paket" target="_blank" rel="external">Paket</a>, here is a sample paket.dependencies file.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">source https:<span class="comment">//nuget.org/api/v2</span></div><div class="line"></div><div class="line">nuget FSharp.Charting</div><div class="line">nuget FSharp.Core</div><div class="line">nuget FSharp.Data</div><div class="line">nuget Deedle</div><div class="line">nuget Newtonsoft.Json</div></pre></td></tr></table></figure>
<p>Again, here is the mostly boilerplate code.  It’s where I load libraries, set the Cognitive Services apikey, and the url for the Frankenstein text on the Gutenberg site.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#r <span class="string">"../packages/FSharp.Charting/lib/net40/FSharp.Charting.dll"</span></div><div class="line">#r <span class="string">"../packages/FSharp.Data/lib/net40/FSharp.Data.dll"</span></div><div class="line">#r <span class="string">"../packages/NewtonSoft.Json/lib/net40/Newtonsoft.Json.dll"</span></div><div class="line">#r <span class="string">"../packages/Deedle/lib/net40/Deedle.dll"</span></div><div class="line"></div><div class="line"><span class="keyword">open</span> System</div><div class="line"><span class="keyword">open</span> System.Text.RegularExpressions</div><div class="line"><span class="keyword">open</span> Deedle</div><div class="line"><span class="keyword">open</span> FSharp.Core</div><div class="line"><span class="keyword">open</span> FSharp.Charting</div><div class="line"><span class="keyword">open</span> FSharp.Data</div><div class="line"><span class="keyword">open</span> Newtonsoft.Json</div><div class="line"></div><div class="line"><span class="keyword">let</span> apiKey = <span class="string">"&lt;your api key here&gt;"</span></div><div class="line"></div><div class="line"><span class="comment">// Frankenstein</span></div><div class="line"><span class="keyword">let</span> bookUrl = <span class="string">"http://www.gutenberg.org/cache/epub/84/pg84.txt"</span></div></pre></td></tr></table></figure>
<p>The below code is mostly a copy of the Sentiment module and supporting functions from my <a href="/2017/01/20/F-and-Text-Analytics/">previous post</a> modified to handle multiple documents.  As promised, the modification to handle multiple documents in <code>TextToRequestJson</code> is an easy adjustment.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">module</span> Sentiment =</div><div class="line">    <span class="keyword">let</span> url = <span class="string">"https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment"</span></div><div class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Document</span> </span>= &#123; language: string; id: string; text: string &#125;</div><div class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Request</span> </span>= &#123; documents: Document list &#125;</div><div class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Score</span> </span>= &#123; score: float; id: string &#125;</div><div class="line">    <span class="class"><span class="keyword">type</span> <span class="title">ResponseError</span> </span>= &#123; id: string; message: string &#125;</div><div class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Response</span> </span>= &#123; documents: Score list; errors: ResponseError list &#125;</div><div class="line"></div><div class="line"><span class="keyword">open</span> Sentiment</div><div class="line"></div><div class="line"><span class="comment">// Convert text documents into request body in json format</span></div><div class="line"><span class="keyword">let</span> TextToRequestJson texts =</div><div class="line">    <span class="keyword">let</span> documents = </div><div class="line">        texts</div><div class="line">        |&gt; Array.map (<span class="keyword">fun</span> t -&gt;</div><div class="line">            &#123; language = <span class="string">"en"</span>;</div><div class="line">              id = string (fst t);</div><div class="line">              text = snd t&#125;)</div><div class="line"></div><div class="line">    <span class="keyword">let</span> request = &#123; Request.documents = (documents |&gt; Array.toList) &#125;</div><div class="line">    JsonConvert.SerializeObject(request)</div><div class="line"></div><div class="line"><span class="comment">// Perform http call</span></div><div class="line"><span class="keyword">let</span> AnalyticsHttp url apiKey body =</div><div class="line">    Http.RequestString(</div><div class="line">        url,</div><div class="line">        httpMethod = <span class="string">"POST"</span>,</div><div class="line">        headers = [</div><div class="line">            <span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>;</div><div class="line">            <span class="string">"Ocp-Apim-Subscription-Key"</span>, apiKey],</div><div class="line">        body = TextRequest body)</div><div class="line"></div><div class="line"><span class="comment">// Wrapper so I can call it F#-style</span></div><div class="line"><span class="keyword">let</span> JsonDeserialize&lt;<span class="symbol">'T</span>&gt; s = JsonConvert.DeserializeObject&lt;<span class="symbol">'T</span>&gt;(s)</div></pre></td></tr></table></figure>
<p>Here is where some special data knowledge is required.  As is typically the case, it is important to know what the data looks like.  Examining the text at the url, its nicely formatted for easy reading. The result is there are line feeds mid paragraph (I’ll need to remove those), and double spacing between paragraphs (I use this to do the paragraph splitting).  Additionally, the page has header and footer information that isn’t the text of the book.  The actual text is designated by the <code>*** START OF...</code> and <code>*** END OF...</code> lines.  They can be used to extract an array slice.  Note, this process may not be perfect, I find a outlier paragraphs that are really long.  It’s possible this naive parsing breaks down a bit.  For my purposes here it’s fine, but for a production process further investigation would be necessary.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Take a string and convert into list of paragraphs</span></div><div class="line"><span class="comment">// Assumption is paragraphs are split by 2 linefeeds</span></div><div class="line"><span class="comment">// Then remove mid-paragraph line breaks</span></div><div class="line"><span class="keyword">let</span> MakeParagraphs bookText =</div><div class="line">    <span class="keyword">let</span> paragraphBreak = <span class="keyword">new</span> Regex(<span class="string">@"\r\n\s*\r\n"</span>)</div><div class="line">    paragraphBreak.Split(bookText)</div><div class="line">    |&gt; Array.map (<span class="keyword">fun</span> x -&gt; x.Replace(<span class="string">"\r\n"</span>, <span class="string">" "</span>))</div><div class="line"></div><div class="line"><span class="comment">// Finds a text in an array and returns its index</span></div><div class="line"><span class="keyword">let</span> getMarkerIndex (m:string) (p:string array) =</div><div class="line">    [<span class="number">0.</span>.(Array.length p) - <span class="number">1</span>]</div><div class="line">    |&gt; List.filter (<span class="keyword">fun</span> i -&gt; p.[i].StartsWith(m))</div><div class="line">    |&gt; List.exactlyOne</div><div class="line"></div><div class="line"><span class="comment">// Extracts only book text from full text</span></div><div class="line"><span class="keyword">let</span> ExtractBook a =</div><div class="line">    <span class="keyword">let</span> bookStart = getMarkerIndex <span class="string">"*** START OF THIS PROJECT GUTENBERG EBOOK"</span> a</div><div class="line">    <span class="keyword">let</span> bookEnd = getMarkerIndex <span class="string">"*** END OF THIS PROJECT GUTENBERG EBOOK"</span> a</div><div class="line">    Array.sub a (bookStart + <span class="number">1</span>) (bookEnd - bookStart)</div></pre></td></tr></table></figure>
<p>The below functions leverage our previously built utility functions to extract the raw text and transform it into paragraph form. Something kind of cool, its easy to miss, <code>Http.RequestString</code> grabs the plain text of url and drops it into a string. After dealing with so many verbose and heavy frameworks its a joy to use something so terse.  Once the text is downloaded and transformed, I perform sentiment and word count analysis of each paragraph.  I will confess, it’s temping to jam it all into a big pipeline that does: <code>url -&gt; (sentiment, wordcount)[]</code>.  For current purposes, I prefer to have intermediate values more accessible.  Also, the process is clean, but at times like these I wish F# had <a href="https://www.haskell.org/" target="_blank" rel="external">Haskell’s</a> lazy infinite sequences as a built-in.  I know F# has it’s ways to do this; but they’re not as clean as Haskell.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Take list of id/text tuples and get sentiment by paragraph</span></div><div class="line"><span class="keyword">let</span> GetSentiment texts =</div><div class="line">    <span class="keyword">let</span> sentimentResponse = </div><div class="line">        texts</div><div class="line">        |&gt; TextToRequestJson</div><div class="line">        |&gt; (AnalyticsHttp Sentiment.url apiKey)</div><div class="line">        |&gt; JsonDeserialize&lt;Sentiment.Response&gt;</div><div class="line"></div><div class="line">    sentimentResponse.documents</div><div class="line">    |&gt; List.map (<span class="keyword">fun</span> x -&gt; (x.id, x.score))</div><div class="line"></div><div class="line"><span class="comment">// Take a gutenberg url and return a book as an array of paragraphs</span></div><div class="line"><span class="keyword">let</span> GetBookParagraphs url =</div><div class="line">    url</div><div class="line">    |&gt; Http.RequestString</div><div class="line">    |&gt; MakeParagraphs</div><div class="line">    |&gt; ExtractBook</div><div class="line"></div><div class="line"><span class="comment">// Take paragraphs and add an id for future usage.</span></div><div class="line"><span class="keyword">let</span> paragraphs =</div><div class="line">    <span class="keyword">let</span> temp = GetBookParagraphs bookUrl</div><div class="line">    ([|<span class="number">1.</span>.Array.length temp|], temp)</div><div class="line">    ||&gt; Array.zip</div><div class="line"></div><div class="line"><span class="comment">// I'd rather write:</span></div><div class="line"><span class="keyword">let</span> paragraphs' = </div><div class="line">	([|<span class="number">1.</span>.|], GetBookParagraphs bookUrl) </div><div class="line">	||&gt; Array.zip</div><div class="line"></div><div class="line"><span class="comment">// If GetBookParagraphs returned a Seq, I could do this:</span></div><div class="line"><span class="keyword">let</span> paragraphs'' =</div><div class="line">    (Seq.initInfinite (<span class="keyword">fun</span> i -&gt; i), GetBookParagraphs bookUrl)</div><div class="line">    ||&gt; Seq.zip</div><div class="line">	</div><div class="line"><span class="comment">// Get sentiment for paragraphs</span></div><div class="line"><span class="keyword">let</span> sentiment = </div><div class="line">    paragraphs</div><div class="line">    |&gt; GetSentiment</div><div class="line"></div><div class="line"><span class="comment">// Get wordcount for paragraphs</span></div><div class="line"><span class="keyword">let</span> wordCounts = </div><div class="line">    paragraphs</div><div class="line">    |&gt; Array.map (<span class="keyword">fun</span> (id, p) -&gt; </div><div class="line">        (id, p.Split([| ' '|]).Length)) </div><div class="line">    |&gt; Array.toList</div></pre></td></tr></table></figure>
<p>Now that I have my sentiment and wordcount lists, it’s time to do some quick analysis.  Leveraging <a href="https://fslab.org/FSharp.Charting/" target="_blank" rel="external">FSharp.Charting</a>, its easy to put some simple reports together.  A warning, the graphs are fun to look at, but there aren’t grand insights into the book.  This is just a fun exercise.  As a reminder sentiment is a scale 0 to 1, where 0 is very negative and 1 is very positive.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Sentiment through book</span></div><div class="line">Chart.Column(sentiment)</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph number"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"Paragraph Sentiment"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>This data is almost too noisy to be useful</p>
<p><img src="/images/sa1/sentiment1.png" alt="Paragraph Sentiment"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Paragraph wordcount through book</span></div><div class="line">Chart.Column(wordCounts)</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph number"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Word Count"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"Words per Paragraph"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>This chart shows a couple of crazy long paragraph outliers.</p>
<p><img src="/images/sa1/wordcount1.png" alt="Paragraph WordCount"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Histogram of paragraph sentiments</span></div><div class="line">Chart.Histogram(sentiment |&gt; List.map snd, Intervals=<span class="number">20.</span>)</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Count"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"Sentiment Histogram"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>Here we see better breakdown on paragraph sentiment.</p>
<p><img src="/images/sa1/sentiment2.png" alt="Sentiment Histogram"></p>
<p>I configure the histogram to use 20 buckets.  With some trial and error, this seemed like a good balance.</p>
<p><em>Note: Partially applied infix operators.  For better or worse, I prefer avoiding the extra lambda syntax.  If I can get away from it without obscuring intent, I do.  Here is a place where I partially apply <code>&lt;</code>, saving me like 13 precious keystrokes: <code>|&gt; List.filter ((&gt;)500)</code>. It’s a fun trick; I think it’s more readable, but it could also be my <a href="https://www.perl.org" target="_blank" rel="external">Perl</a> golfing tendancies emerging.</em></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Wordcount histogram (filter out paragraphs &gt; 500 words)</span></div><div class="line">Chart.Histogram(</div><div class="line">    wordCounts </div><div class="line">    |&gt; List.map snd </div><div class="line">    |&gt; List.filter ((&gt;)<span class="number">500</span>),</div><div class="line">    Intervals=<span class="number">20.</span>)</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"WordCount"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Count"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"WordCount Histogram"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>Most paragraphs are under 200 words, with the lionshare being less than 100 words.<br><img src="/images/sa1/wordcount2.png" alt="Wordcount Histogram"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Wordcount/Sentiment graph</span></div><div class="line">(wordCounts    |&gt; List.map snd, </div><div class="line"> sentiment     |&gt; List.map snd)</div><div class="line">||&gt; List.zip</div><div class="line">|&gt; Chart.Point</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Words per Paragraph"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"WordCount and Sentiment"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>Here we see if there is any trend with respect to paragraph wordcount and sentiment.  I don’t really see one.</p>
<p><img src="/images/sa1/wordcount_sentiment.png" alt="Wordcount and Sentiment"></p>
<p>This is post is primarily about about using stock F#, and watching the data flow.  With that said, I would be remiss if I didn’t mention <a href="https://github.com/BlueMountainCapital/Deedle" target="_blank" rel="external">Deedle</a>.  To do serious data analysis, Deedle is a powerful tool.  It’s ability to manage and manipulate dataframes and series is extremely useful.  The below tidbits don’t do the library justice, but they do provide a small taste of what can be accomplished easily.</p>
<p>Below I convert the data into a series, allowing more advanced reporting.  Then I generate a moving average, using 30 paragraphs as the window.  If you remember from above, the raw data was interesting, but I don’t believe overly insightful.  A moving average helps to soften peaks and display trends better.  </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Turn sentiment into a Deedle series</span></div><div class="line"><span class="keyword">let</span> sentimentSeries = sentiment |&gt; series</div><div class="line"></div><div class="line"><span class="comment">// Chart a moving average</span></div><div class="line">Stats.movingMean <span class="number">30</span> sentimentSeries</div><div class="line">|&gt; Series.observations</div><div class="line">|&gt; Chart.Line</div><div class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Number"</span>)</div><div class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</div><div class="line">|&gt; Chart.WithTitle(<span class="string">"Sentiment Moving Average"</span>)</div><div class="line">|&gt; Chart.Show</div></pre></td></tr></table></figure>
<p>It looks like there are periods of the book that use darker tones.  </p>
<p><img src="/images/sa1/sentiment3.png" alt="Sentiment Moving Average"></p>
<p>Series provide a mechanism for basic series statistics.  There is no need to calculate these yourself.  This is not the full range of functionality, again it is just a view into the type of calculations readily available.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Sentiment stats</span></div><div class="line">printfn <span class="string">"Mean: %.2f Median: %.2f Min: %.2f Max: %.2f StdDev: %.2f Variance: %.2f"</span> </div><div class="line">    (sentimentSeries.Mean())</div><div class="line">    (sentimentSeries.Median())</div><div class="line">    (sentimentSeries.Min())</div><div class="line">    (sentimentSeries.Max())</div><div class="line">    (Stats.stdDev sentimentSeries)</div><div class="line">    (Stats.variance sentimentSeries)</div><div class="line"></div><div class="line">Output:</div><div class="line">Mean: <span class="number">0.58</span> Median: <span class="number">0.67</span> Min: <span class="number">0.00</span> Max: <span class="number">1.00</span> StdDev: <span class="number">0.36</span> Variance: <span class="number">0.13</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// WordCount Stats</span></div><div class="line"><span class="keyword">let</span> wordCountsSeries = wordCounts |&gt; List.map (<span class="keyword">fun</span> (a,b) -&gt; (a, float b)) |&gt; series</div><div class="line"></div><div class="line">printfn <span class="string">"Mean: %.2f Median: %.2f Min: %.2f Max: %.2f StdDev: %.2f Variance: %.2f"</span> </div><div class="line">    (wordCountsSeries.Mean())</div><div class="line">    (wordCountsSeries.Median())</div><div class="line">    (wordCountsSeries.Min())</div><div class="line">    (wordCountsSeries.Max())</div><div class="line">    (Stats.stdDev wordCountsSeries)</div><div class="line">    (Stats.variance wordCountsSeries)</div><div class="line"></div><div class="line">Output:</div><div class="line">Mean: <span class="number">106.98</span> Median: <span class="number">85.50</span> Min: <span class="number">1.00</span> Max: <span class="number">884.00</span> StdDev: <span class="number">94.90</span> Variance: <span class="number">9006.50</span></div></pre></td></tr></table></figure>
<p>I hope you enjoyed this slightly deeper examination into sentiment analysis and F#.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://codesuji.com/2017/01/26/Simple-Analysis-with-F/" data-id="ciygjddns000aaklix7ingawx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Analytics/">Analytics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cognitive-Services/">Cognitive Services</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data/">Data</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deedle/">Deedle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/F/">F#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FSharp/">FSharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Http/">Http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Statistics/">Statistics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Text/">Text</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webapi/">Webapi</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/01/20/F-and-Text-Analytics/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">F# and Text Analytics</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Accord-NET/" style="font-size: 16.67px;">Accord.NET</a> <a href="/tags/Analytics/" style="font-size: 11.67px;">Analytics</a> <a href="/tags/Audio/" style="font-size: 10px;">Audio</a> <a href="/tags/Classification/" style="font-size: 11.67px;">Classification</a> <a href="/tags/Cognitive-Services/" style="font-size: 11.67px;">Cognitive Services</a> <a href="/tags/Computer-Vision/" style="font-size: 10px;">Computer Vision</a> <a href="/tags/DTW/" style="font-size: 11.67px;">DTW</a> <a href="/tags/Data/" style="font-size: 18.33px;">Data</a> <a href="/tags/Decision-Trees/" style="font-size: 11.67px;">Decision Trees</a> <a href="/tags/Deedle/" style="font-size: 10px;">Deedle</a> <a href="/tags/Delegate/" style="font-size: 10px;">Delegate</a> <a href="/tags/Detection/" style="font-size: 10px;">Detection</a> <a href="/tags/Dynamic-Time-Warping/" style="font-size: 11.67px;">Dynamic Time Warping</a> <a href="/tags/EEG/" style="font-size: 10px;">EEG</a> <a href="/tags/Edges/" style="font-size: 10px;">Edges</a> <a href="/tags/F/" style="font-size: 20px;">F#</a> <a href="/tags/FSharp/" style="font-size: 20px;">FSharp</a> <a href="/tags/Faces/" style="font-size: 10px;">Faces</a> <a href="/tags/Filters/" style="font-size: 10px;">Filters</a> <a href="/tags/Http/" style="font-size: 11.67px;">Http</a> <a href="/tags/Images/" style="font-size: 11.67px;">Images</a> <a href="/tags/Ionide/" style="font-size: 10px;">Ionide</a> <a href="/tags/Kaggle/" style="font-size: 10px;">Kaggle</a> <a href="/tags/Legos/" style="font-size: 11.67px;">Legos</a> <a href="/tags/Machine-Learning/" style="font-size: 15px;">Machine Learning</a> <a href="/tags/MathNet/" style="font-size: 10px;">MathNet</a> <a href="/tags/Mono/" style="font-size: 10px;">Mono</a> <a href="/tags/Morse-Code/" style="font-size: 10px;">Morse Code</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/Racket/" style="font-size: 10px;">Racket</a> <a href="/tags/Regression/" style="font-size: 10px;">Regression</a> <a href="/tags/Scoring/" style="font-size: 10px;">Scoring</a> <a href="/tags/Signals/" style="font-size: 11.67px;">Signals</a> <a href="/tags/Similarity/" style="font-size: 11.67px;">Similarity</a> <a href="/tags/Sound/" style="font-size: 10px;">Sound</a> <a href="/tags/Statistics/" style="font-size: 13.33px;">Statistics</a> <a href="/tags/Tail-calls/" style="font-size: 10px;">Tail calls</a> <a href="/tags/Text/" style="font-size: 11.67px;">Text</a> <a href="/tags/Translation/" style="font-size: 10px;">Translation</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Webapi/" style="font-size: 11.67px;">Webapi</a> <a href="/tags/admin/" style="font-size: 10px;">admin</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 codesuji.com<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>