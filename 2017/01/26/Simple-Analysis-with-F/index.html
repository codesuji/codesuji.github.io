<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Simple Analysis with F# | codesuji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  I’ll also use this as an opportunity to draw more">
<meta name="keywords" content="Data,F#,FSharp,Statistics,Text,Cognitive Services,Webapi,Http,Analytics,Deedle">
<meta property="og:type" content="article">
<meta property="og:title" content="Simple Analysis with F#">
<meta property="og:url" content="http://codesuji.com/2017/01/26/Simple-Analysis-with-F/index.html">
<meta property="og:site_name" content="codesuji">
<meta property="og:description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  I’ll also use this as an opportunity to draw more">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment1.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount1.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment2.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount2.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/wordcount_sentiment.png">
<meta property="og:image" content="http://codesuji.com/images/sa1/sentiment3.png">
<meta property="og:updated_time" content="2017-12-23T19:03:14.112Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple Analysis with F#">
<meta name="twitter:description" content="This post is a follow up to my previous look into Text Analytics.  It will provide additional examples of how data can be pulled and processed in F#.  I’ll also use this as an opportunity to draw more">
<meta name="twitter:image" content="http://codesuji.com/images/sa1/sentiment1.png">
  
    <link rel="alternate" href="/atom.xml" title="codesuji" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89982547-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">codesuji</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://codesuji.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Simple-Analysis-with-F" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/26/Simple-Analysis-with-F/" class="article-date">
  <time datetime="2017-01-27T03:10:36.000Z" itemprop="datePublished">2017-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Simple Analysis with F#
    </h1>
  

 		<span class="post-count">Read Time: 12 minutes</span>
 	  </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This post is a follow up to my previous look into <a href="/2017/01/20/F-and-Text-Analytics/">Text Analytics</a>.  It will provide additional examples of how data can be pulled and processed in <a href="http://fsharp.org/" target="_blank" rel="noopener">F#</a>.  I’ll also use this as an opportunity to draw more charts.  For all this to happen, I’ll be doing light analysis of the full text of Mary Shelley’s “Frankenstein”.</p>
<a id="more"></a>
<p>Like last time, if you want to follow along, you’ll need to first get a free account from <a href="https://www.microsoft.com/cognitive-services/en-us/" target="_blank" rel="noopener">Cognitive Services</a>.  Then request the api access you want, for this post it is “Text Analytics”.  The apikey they provide can be used in the upcoming code if you want to make your own calls.  Microsoft offers a nice amount of free calls, providing plenty of room to play in the environment.  </p>
<p>Using <a href="https://github.com/fsprojects/Paket" target="_blank" rel="noopener">Paket</a>, here is a sample paket.dependencies file.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">source https:<span class="comment">//nuget.org/api/v2</span></span><br><span class="line"></span><br><span class="line">nuget FSharp.Charting</span><br><span class="line">nuget FSharp.Core</span><br><span class="line">nuget FSharp.Data</span><br><span class="line">nuget Deedle</span><br><span class="line">nuget Newtonsoft.Json</span><br></pre></td></tr></table></figure>
<p>Again, here is the mostly boilerplate code.  It’s where I load libraries, set the Cognitive Services apikey, and the url for the Frankenstein text on the Gutenberg site.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#r <span class="string">"../packages/FSharp.Charting/lib/net40/FSharp.Charting.dll"</span></span><br><span class="line">#r <span class="string">"../packages/FSharp.Data/lib/net40/FSharp.Data.dll"</span></span><br><span class="line">#r <span class="string">"../packages/NewtonSoft.Json/lib/net40/Newtonsoft.Json.dll"</span></span><br><span class="line">#r <span class="string">"../packages/Deedle/lib/net40/Deedle.dll"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> System</span><br><span class="line"><span class="keyword">open</span> System.Text.RegularExpressions</span><br><span class="line"><span class="keyword">open</span> Deedle</span><br><span class="line"><span class="keyword">open</span> FSharp.Core</span><br><span class="line"><span class="keyword">open</span> FSharp.Charting</span><br><span class="line"><span class="keyword">open</span> FSharp.Data</span><br><span class="line"><span class="keyword">open</span> Newtonsoft.Json</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> apiKey = <span class="string">"&lt;your api key here&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Frankenstein</span></span><br><span class="line"><span class="keyword">let</span> bookUrl = <span class="string">"http://www.gutenberg.org/cache/epub/84/pg84.txt"</span></span><br></pre></td></tr></table></figure>
<p>The below code is mostly a copy of the Sentiment module and supporting functions from my <a href="/2017/01/20/F-and-Text-Analytics/">previous post</a>, modified to handle multiple documents.  As promised, the modification to handle multiple documents in <code>TextToRequestJson</code> was an easy adjustment.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Sentiment =</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">"https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment"</span></span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Document</span> </span>= &#123; language: string; id: string; text: string &#125;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Request</span> </span>= &#123; documents: Document list &#125;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Score</span> </span>= &#123; score: float; id: string &#125;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">ResponseError</span> </span>= &#123; id: string; message: string &#125;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Response</span> </span>= &#123; documents: Score list; errors: ResponseError list &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> Sentiment</span><br><span class="line"></span><br><span class="line"><span class="comment">// Convert text documents into request body in json format</span></span><br><span class="line"><span class="keyword">let</span> TextToRequestJson texts =</span><br><span class="line">    <span class="keyword">let</span> documents = </span><br><span class="line">        texts</span><br><span class="line">        |&gt; Array.map (<span class="keyword">fun</span> t -&gt;</span><br><span class="line">            &#123; language = <span class="string">"en"</span>;</span><br><span class="line">              id = string (fst t);</span><br><span class="line">              text = snd t&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> request = &#123; Request.documents = (documents |&gt; Array.toList) &#125;</span><br><span class="line">    JsonConvert.SerializeObject(request)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Perform http call</span></span><br><span class="line"><span class="keyword">let</span> AnalyticsHttp url apiKey body =</span><br><span class="line">    Http.RequestString(</span><br><span class="line">        url,</span><br><span class="line">        httpMethod = <span class="string">"POST"</span>,</span><br><span class="line">        headers = [</span><br><span class="line">            <span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>;</span><br><span class="line">            <span class="string">"Ocp-Apim-Subscription-Key"</span>, apiKey],</span><br><span class="line">        body = TextRequest body)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wrapper so I can call it F#-style</span></span><br><span class="line"><span class="keyword">let</span> JsonDeserialize&lt;<span class="symbol">'T</span>&gt; s = JsonConvert.DeserializeObject&lt;<span class="symbol">'T</span>&gt;(s)</span><br></pre></td></tr></table></figure>
<p>Here is where some special data knowledge is required.  As is typically the case, it is important to know what the data looks like.  Examining the text at the url, its nicely formatted for easy reading. The result is there are line feeds mid paragraph (I’ll need to remove those), and double spacing between paragraphs (I use these to do the paragraph splitting).  Additionally, the webpage has header and footer information that isn’t the text of the book.  The actual text is designated by the <code>*** START OF...</code> and <code>*** END OF...</code> lines.  I use them to extract the section of book text from the page.  This naive method may not be perfect, but I think it’s pretty good.  It is certainly good enough for my current purpose.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Take a string and convert into list of paragraphs</span></span><br><span class="line"><span class="comment">// Assumption is paragraphs are split by 2 linefeeds</span></span><br><span class="line"><span class="comment">// Then remove mid-paragraph line breaks</span></span><br><span class="line"><span class="keyword">let</span> MakeParagraphs bookText =</span><br><span class="line">    <span class="keyword">let</span> paragraphBreak = <span class="keyword">new</span> Regex(<span class="string">@"\r\n\s*\r\n"</span>)</span><br><span class="line">    paragraphBreak.Split(bookText)</span><br><span class="line">    |&gt; Array.map (<span class="keyword">fun</span> x -&gt; x.Replace(<span class="string">"\r\n"</span>, <span class="string">" "</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Finds a text in an array and returns its index</span></span><br><span class="line"><span class="keyword">let</span> getMarkerIndex (m:string) (p:string array) =</span><br><span class="line">    [<span class="number">0.</span>.(Array.length p) - <span class="number">1</span>]</span><br><span class="line">    |&gt; List.filter (<span class="keyword">fun</span> i -&gt; p.[i].StartsWith(m))</span><br><span class="line">    |&gt; List.exactlyOne</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extracts only book text from full text</span></span><br><span class="line"><span class="keyword">let</span> ExtractBook a =</span><br><span class="line">    <span class="keyword">let</span> bookStart = getMarkerIndex <span class="string">"*** START OF THIS PROJECT GUTENBERG EBOOK"</span> a</span><br><span class="line">    <span class="keyword">let</span> bookEnd = getMarkerIndex <span class="string">"*** END OF THIS PROJECT GUTENBERG EBOOK"</span> a</span><br><span class="line">    Array.sub a (bookStart + <span class="number">1</span>) (bookEnd - bookStart)</span><br></pre></td></tr></table></figure>
<p>The below functions leverage the previously built utility functions to extract the raw text and transform it into paragraph form. Something kind of cool, its easy to miss, <code>Http.RequestString</code> grabs the plain text of url and drops it into a string. After dealing with so many verbose and heavy frameworks its a joy to use something so terse.  Once the text is downloaded and transformed, I perform sentiment and word count analysis of each paragraph.  I will confess, it’s temping to jam it all into a big pipeline of functions that do: <code>url -&gt; (sentiment, wordcount)[]</code>.  For current purposes, I prefer to have intermediate values more accessible.  Also, the process is clean, but at times like these I wish F# had <a href="https://www.haskell.org/" target="_blank" rel="noopener">Haskell’s</a> lazy infinite sequences as a built-in (see the <code>paragraph</code> variants below).  I know F# has it’s ways to do this; but they’re not as clean as Haskell.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Take list of id/text tuples and get sentiment by paragraph</span></span><br><span class="line"><span class="keyword">let</span> GetSentiment texts =</span><br><span class="line">    <span class="keyword">let</span> sentimentResponse = </span><br><span class="line">        texts</span><br><span class="line">        |&gt; TextToRequestJson</span><br><span class="line">        |&gt; (AnalyticsHttp Sentiment.url apiKey)</span><br><span class="line">        |&gt; JsonDeserialize&lt;Sentiment.Response&gt;</span><br><span class="line"></span><br><span class="line">    sentimentResponse.documents</span><br><span class="line">    |&gt; List.map (<span class="keyword">fun</span> x -&gt; (x.id, x.score))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Take a gutenberg url and return a book as an array of paragraphs</span></span><br><span class="line"><span class="keyword">let</span> GetBookParagraphs url =</span><br><span class="line">    url</span><br><span class="line">    |&gt; Http.RequestString</span><br><span class="line">    |&gt; MakeParagraphs</span><br><span class="line">    |&gt; ExtractBook</span><br><span class="line"></span><br><span class="line"><span class="comment">// Take paragraphs and add an id for future usage.</span></span><br><span class="line"><span class="keyword">let</span> paragraphs =</span><br><span class="line">    <span class="keyword">let</span> temp = GetBookParagraphs bookUrl</span><br><span class="line">    ([|<span class="number">1.</span>.Array.length temp|], temp)</span><br><span class="line">    ||&gt; Array.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">// I'd rather write:</span></span><br><span class="line"><span class="keyword">let</span> paragraphs' = </span><br><span class="line">	([|<span class="number">1.</span>.|], GetBookParagraphs bookUrl) </span><br><span class="line">	||&gt; Array.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">// If I wrote GetBookParagraphs to return a Seq, I could do this:</span></span><br><span class="line"><span class="keyword">let</span> paragraphs'' =</span><br><span class="line">    (Seq.initInfinite (<span class="keyword">fun</span> i -&gt; i), GetBookParagraphs bookUrl)</span><br><span class="line">    ||&gt; Seq.zip</span><br><span class="line">	</span><br><span class="line"><span class="comment">// Get sentiment for paragraphs</span></span><br><span class="line"><span class="keyword">let</span> sentiment = </span><br><span class="line">    paragraphs</span><br><span class="line">    |&gt; GetSentiment</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get wordcount for paragraphs</span></span><br><span class="line"><span class="keyword">let</span> wordCounts = </span><br><span class="line">    paragraphs</span><br><span class="line">    |&gt; Array.map (<span class="keyword">fun</span> (id, p) -&gt; </span><br><span class="line">        (id, p.Split([| ' '|]).Length)) </span><br><span class="line">    |&gt; Array.toList</span><br></pre></td></tr></table></figure>
<p>Now that I have my sentiment and wordcount lists, it’s time to do some quick analysis.  Leveraging <a href="https://fslab.org/FSharp.Charting/" target="_blank" rel="noopener">FSharp.Charting</a>, its easy to put some simple reports together.  A warning, the graphs are fun to look at, but there aren’t grand insights into the book.  This is just a fun exercise.  As a reminder sentiment is a scale 0 to 1, where 0 is very negative and 1 is very positive.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sentiment through book</span></span><br><span class="line">Chart.Column(sentiment)</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph number"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"Paragraph Sentiment"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>This data is almost too noisy to be useful</p>
<p><img src="/images/sa1/sentiment1.png" alt="Paragraph Sentiment"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Paragraph wordcount through book</span></span><br><span class="line">Chart.Column(wordCounts)</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph number"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Word Count"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"Words per Paragraph"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>This chart shows a couple of crazy long paragraph outliers.</p>
<p><img src="/images/sa1/wordcount1.png" alt="Paragraph WordCount"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Histogram of paragraph sentiments</span></span><br><span class="line">Chart.Histogram(sentiment |&gt; List.map snd, Intervals=<span class="number">20.</span>)</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Count"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"Sentiment Histogram"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>Here we see better breakdown on paragraph sentiment.</p>
<p><img src="/images/sa1/sentiment2.png" alt="Sentiment Histogram"></p>
<p>I configure the histogram to use 20 buckets.  With some trial and error, this seemed like a good balance.</p>
<p><em>Note: Partially applied infix operators.  For better or worse, I prefer avoiding the extra lambda syntax.  If I can get away from it without obscuring intent, I do.  Here is a place where I partially apply <code>&lt;</code>, saving me like 13 precious keystrokes: <code>|&gt; List.filter ((&gt;)500)</code>. It’s a fun trick; I think it’s more readable, but it could also be my <a href="https://www.perl.org" target="_blank" rel="noopener">Perl</a> golfing tendancies emerging.</em></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wordcount histogram (filter out paragraphs &gt; 500 words)</span></span><br><span class="line">Chart.Histogram(</span><br><span class="line">    wordCounts </span><br><span class="line">    |&gt; List.map snd </span><br><span class="line">    |&gt; List.filter ((&gt;)<span class="number">500</span>),</span><br><span class="line">    Intervals=<span class="number">20.</span>)</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"WordCount"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Count"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"WordCount Histogram"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>Most paragraphs are under 200 words, with the lionshare being less than 100 words.<br><img src="/images/sa1/wordcount2.png" alt="Wordcount Histogram"></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wordcount/Sentiment graph</span></span><br><span class="line">(wordCounts    |&gt; List.map snd, </span><br><span class="line"> sentiment     |&gt; List.map snd)</span><br><span class="line">||&gt; List.zip</span><br><span class="line">|&gt; Chart.Point</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Words per Paragraph"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"WordCount and Sentiment"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>Here we see if there is any trend with respect to paragraph wordcount and sentiment.  I don’t really see one.</p>
<p><img src="/images/sa1/wordcount_sentiment.png" alt="Wordcount and Sentiment"></p>
<p>This is post is primarily about about using stock F#, and watching the data flow.  With that said, I would be remiss if I didn’t mention <a href="https://github.com/BlueMountainCapital/Deedle" target="_blank" rel="noopener">Deedle</a>.  To do serious data analysis, Deedle is a powerful tool.  It’s ability to manage and manipulate dataframes and series is extremely useful.  The below tidbits don’t do the library justice, but they do provide a small taste of what can be accomplished easily.</p>
<p>Below I convert the data into a series, allowing more advanced reporting.  Then I generate a moving average, using 30 paragraphs as the window.  If you remember from above, the raw data was interesting, but I don’t believe overly insightful.  A moving average helps to soften peaks and display trends better.  </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Turn sentiment into a Deedle series</span></span><br><span class="line"><span class="keyword">let</span> sentimentSeries = sentiment |&gt; series</span><br><span class="line"></span><br><span class="line"><span class="comment">// Chart a moving average</span></span><br><span class="line">Stats.movingMean <span class="number">30</span> sentimentSeries</span><br><span class="line">|&gt; Series.observations</span><br><span class="line">|&gt; Chart.Line</span><br><span class="line">|&gt; Chart.WithXAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Paragraph Number"</span>)</span><br><span class="line">|&gt; Chart.WithYAxis(Enabled=<span class="keyword">true</span>, Title=<span class="string">"Sentiment"</span>)</span><br><span class="line">|&gt; Chart.WithTitle(<span class="string">"Sentiment Moving Average"</span>)</span><br><span class="line">|&gt; Chart.Show</span><br></pre></td></tr></table></figure>
<p>This shows a easier to read sentiment trend.  The periods of the book that use darker tones are easier to see now.  </p>
<p><img src="/images/sa1/sentiment3.png" alt="Sentiment Moving Average"></p>
<p>Series provide a mechanism for basic series statistics.  There is no need to calculate these yourself.  This is not the full range of functionality, again it is just a view into the type of calculations readily available.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sentiment stats</span></span><br><span class="line">printfn <span class="string">"Mean: %.2f Median: %.2f Min: %.2f Max: %.2f StdDev: %.2f Variance: %.2f"</span> </span><br><span class="line">    (sentimentSeries.Mean())</span><br><span class="line">    (sentimentSeries.Median())</span><br><span class="line">    (sentimentSeries.Min())</span><br><span class="line">    (sentimentSeries.Max())</span><br><span class="line">    (Stats.stdDev sentimentSeries)</span><br><span class="line">    (Stats.variance sentimentSeries)</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">Mean: <span class="number">0.58</span> Median: <span class="number">0.67</span> Min: <span class="number">0.00</span> Max: <span class="number">1.00</span> StdDev: <span class="number">0.36</span> Variance: <span class="number">0.13</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// WordCount Stats</span></span><br><span class="line"><span class="keyword">let</span> wordCountsSeries = wordCounts |&gt; List.map (<span class="keyword">fun</span> (a,b) -&gt; (a, float b)) |&gt; series</span><br><span class="line"></span><br><span class="line">printfn <span class="string">"Mean: %.2f Median: %.2f Min: %.2f Max: %.2f StdDev: %.2f Variance: %.2f"</span> </span><br><span class="line">    (wordCountsSeries.Mean())</span><br><span class="line">    (wordCountsSeries.Median())</span><br><span class="line">    (wordCountsSeries.Min())</span><br><span class="line">    (wordCountsSeries.Max())</span><br><span class="line">    (Stats.stdDev wordCountsSeries)</span><br><span class="line">    (Stats.variance wordCountsSeries)</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">Mean: <span class="number">106.98</span> Median: <span class="number">85.50</span> Min: <span class="number">1.00</span> Max: <span class="number">884.00</span> StdDev: <span class="number">94.90</span> Variance: <span class="number">9006.50</span></span><br></pre></td></tr></table></figure>
<p>I hope you enjoyed this slightly deeper examination into sentiment analysis and F#.</p>

        <div class="related-posts-box">
        Related Posts:<ul class="related-posts"><li class="related-posts-item"><a class="related-posts-link" href="/2017/01/20/F-and-Text-Analytics/">F# and Text Analytics</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2018/04/24/FSharp-and-Word-Stems/">F# and Word Stems</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2017/08/27/K-Means-Clustering-with-F/">K-Means Clustering with F#</a></li></ul>        </div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://codesuji.com/2017/01/26/Simple-Analysis-with-F/" data-id="cjo9c911v000yb9m05pnfe01z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Analytics/">Analytics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cognitive-Services/">Cognitive Services</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data/">Data</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deedle/">Deedle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/F/">F#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FSharp/">FSharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Http/">Http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Statistics/">Statistics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Text/">Text</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webapi/">Webapi</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/19/bf-compiler-part1-parsing/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          BF Compiler Part 1 - Parsing
        
      </div>
    </a>
  
  
    <a href="/2017/01/20/F-and-Text-Analytics/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">F# and Text Analytics</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Core/" style="font-size: 16.25px;">.NET Core</a> <a href="/tags/Accord-NET/" style="font-size: 16.25px;">Accord.NET</a> <a href="/tags/Analytics/" style="font-size: 15px;">Analytics</a> <a href="/tags/Audio/" style="font-size: 10px;">Audio</a> <a href="/tags/Benchmarking/" style="font-size: 10px;">Benchmarking</a> <a href="/tags/Chiron/" style="font-size: 10px;">Chiron</a> <a href="/tags/Classification/" style="font-size: 11.25px;">Classification</a> <a href="/tags/Cognitive-Services/" style="font-size: 11.25px;">Cognitive Services</a> <a href="/tags/Compiler/" style="font-size: 13.75px;">Compiler</a> <a href="/tags/Computer-Vision/" style="font-size: 11.25px;">Computer Vision</a> <a href="/tags/DTW/" style="font-size: 11.25px;">DTW</a> <a href="/tags/Data/" style="font-size: 17.5px;">Data</a> <a href="/tags/Database/" style="font-size: 11.25px;">Database</a> <a href="/tags/Decision-Trees/" style="font-size: 11.25px;">Decision Trees</a> <a href="/tags/Deedle/" style="font-size: 10px;">Deedle</a> <a href="/tags/Delegate/" style="font-size: 10px;">Delegate</a> <a href="/tags/Detection/" style="font-size: 10px;">Detection</a> <a href="/tags/Dynamic-Time-Warping/" style="font-size: 11.25px;">Dynamic Time Warping</a> <a href="/tags/EEG/" style="font-size: 10px;">EEG</a> <a href="/tags/Edges/" style="font-size: 10px;">Edges</a> <a href="/tags/EmguCV/" style="font-size: 10px;">EmguCV</a> <a href="/tags/F/" style="font-size: 20px;">F#</a> <a href="/tags/FParsec/" style="font-size: 12.5px;">FParsec</a> <a href="/tags/FSAdvent/" style="font-size: 10px;">FSAdvent</a> <a href="/tags/FSharp/" style="font-size: 20px;">FSharp</a> <a href="/tags/Faces/" style="font-size: 11.25px;">Faces</a> <a href="/tags/Filters/" style="font-size: 10px;">Filters</a> <a href="/tags/Http/" style="font-size: 11.25px;">Http</a> <a href="/tags/Images/" style="font-size: 12.5px;">Images</a> <a href="/tags/Ionide/" style="font-size: 10px;">Ionide</a> <a href="/tags/Kaggle/" style="font-size: 12.5px;">Kaggle</a> <a href="/tags/Legos/" style="font-size: 11.25px;">Legos</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/MLNet/" style="font-size: 15px;">MLNet</a> <a href="/tags/MSIL/" style="font-size: 12.5px;">MSIL</a> <a href="/tags/Machine-Learning/" style="font-size: 18.75px;">Machine Learning</a> <a href="/tags/MathNet/" style="font-size: 10px;">MathNet</a> <a href="/tags/Mono/" style="font-size: 10px;">Mono</a> <a href="/tags/Morse-Code/" style="font-size: 10px;">Morse Code</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/Parsing/" style="font-size: 12.5px;">Parsing</a> <a href="/tags/Racket/" style="font-size: 10px;">Racket</a> <a href="/tags/Regression/" style="font-size: 10px;">Regression</a> <a href="/tags/Rekognition/" style="font-size: 10px;">Rekognition</a> <a href="/tags/Robotics/" style="font-size: 10px;">Robotics</a> <a href="/tags/Scoring/" style="font-size: 10px;">Scoring</a> <a href="/tags/Search/" style="font-size: 10px;">Search</a> <a href="/tags/Serialization/" style="font-size: 10px;">Serialization</a> <a href="/tags/SignalR/" style="font-size: 10px;">SignalR</a> <a href="/tags/Signals/" style="font-size: 11.25px;">Signals</a> <a href="/tags/Similarity/" style="font-size: 11.25px;">Similarity</a> <a href="/tags/Sound/" style="font-size: 10px;">Sound</a> <a href="/tags/Statistics/" style="font-size: 13.75px;">Statistics</a> <a href="/tags/Tail-calls/" style="font-size: 10px;">Tail calls</a> <a href="/tags/Text/" style="font-size: 15px;">Text</a> <a href="/tags/Translation/" style="font-size: 10px;">Translation</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Webapi/" style="font-size: 11.25px;">Webapi</a> <a href="/tags/admin/" style="font-size: 11.25px;">admin</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 codesuji.com<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>