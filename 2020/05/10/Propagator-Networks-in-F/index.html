<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Propagator Networks in F# | codesuji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Propagator Networks are an interesting approach to computation.  Today I want to provide an introduction to the concept of propagators using F#.">
<meta name="keywords" content="F#,FSharp,Propagator">
<meta property="og:type" content="article">
<meta property="og:title" content="Propagator Networks in F#">
<meta property="og:url" content="http://codesuji.com/2020/05/10/Propagator-Networks-in-F/index.html">
<meta property="og:site_name" content="codesuji">
<meta property="og:description" content="Propagator Networks are an interesting approach to computation.  Today I want to provide an introduction to the concept of propagators using F#.">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://codesuji.com/images/prop1/temperature-network.png">
<meta property="og:image" content="http://codesuji.com/images/prop1/aggregated-intervals.png">
<meta property="og:updated_time" content="2020-05-10T23:37:04.725Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Propagator Networks in F#">
<meta name="twitter:description" content="Propagator Networks are an interesting approach to computation.  Today I want to provide an introduction to the concept of propagators using F#.">
<meta name="twitter:image" content="http://codesuji.com/images/prop1/temperature-network.png">
    <link rel="stylesheet" href="css/fontawesome.css" type="text/css">
  
    <link rel="alternate" href="/atom.xml" title="codesuji" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">codesuji</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
          <a id="nav-share-link" class="nav-icon fa-solid fa-user" href="https://bsky.app/profile/codesuji.bsky.social" title="BlueSky" target="_blank"></a>
          <a id="nav-share-link" class="nav-icon fa-solid fa-user" href="https://hachyderm.io/@codesuji" title="Mastodon" target="_blank"></a>
          <a id="nav-rss-link" class="nav-icon fa-solid fa-rss" href="/atom.xml" title="RSS Feed"></a>
          <a id="nav-search-btn" class="nav-icon fa-solid fa-search" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://codesuji.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Propagator-Networks-in-F" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/10/Propagator-Networks-in-F/" class="article-date">
  <time datetime="2020-05-10T12:32:07.000Z" itemprop="datePublished">2020-05-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Propagator Networks in F#
    </h1>
  

 		<span class="post-count">Read Time: 17 minutes</span>
 	  </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Propagator Networks are an interesting approach to computation.  Today I want to provide an introduction to the concept of propagators using <a href="https://fsharp.org" target="_blank" rel="noopener">F#</a>.</p>
<a id="more"></a>
<p>First, what is a propagator network?  In short, it is a computational method that provides a unique approach to model information and it’s flow through a system.  It’s concepts and motivations are described in several papers by Alexey Radul and Gerald Sussman, <a href="#references">references</a> below.  Here I’ll provide a brief overview as well as some examples.  On the surface, propagator networks are constructed of two primary components: cells and propagators.  Cells are independent entities that maintain their own data.  Propagators are functional connectors that propagate information between cells.  These two parts work together to provide a method of data accumulation and computation.</p>
<p>To go a bit deeper, cells don’t just hold data, but accumulate data.  For datatypes like int, this is relatively straight-forward.  When a cell is created it may have a known value.  But it may also be unknown (no information), since the implementation uses the Option type, it initialized with None.  As data is processed through the network, a cell may increase it’s information with an actual value when available.  For an Interval datatype this is more interesting.  It too can have information when initialized, but in cases where there is no information, it is initialized with None.  But as the network processes data, the cell accumulates additional information, resulting in more accurate interval values.</p>
<p>Propagators calculate and push data through the network, allowing cells to accumulate additional information.  Propagators must adhere to several rules.  They must be monotonically increasing.  The information they pass to a cell must be at least as good or better than what the cell contained before.  Since a cell is an Option type, in a basic sense any value is better than None (information is better than no information).  The real power is best seen using the Interval datatype.  For example, if a cell has the value range 10.1 - 12.2, any value a propagator passes to that cell must be at least this good.  A new value of 10.1 - 11.0 is more precise (better), but a value of 9.0 - 15.0 is less precise (worse).  As a result, a propagator would update the cell with the former value, but not the latter.  Propagators must also be idempotent.  Since a propagator can be triggered to executed multiple times, it must return the same data.  These attributes work to support stability, internal autonomy, asynchronous execution, as well as proper accumulation of information.  </p>
<p>Propagators should also be bi-directional in their computational ability.  This is what allows data to flow in both directions across operators.  In general this means a propagator for the function <code>p(a) = b</code> should have bundled an equivalent function <code>p&#39;(b) = a</code>.  As an example, imagine a function <code>a + b = c</code>.  There are reciprocal functions <code>c - b = a</code> and <code>c - a = b</code>.  A propagator is the bundling of these functions together so that given any two values it can provide the third.  This allows a developer to write <code>adder a b c</code> to create an addition function of <code>a + b = c</code>, but get functional computation in all directions for free. </p>
<p>These components and their associated rules provide some interesting computational characteristics for accumulating data.  A model of data relationships only need to be defined once.  It enables data population from diverse sources, and a more robust representation of knowledge.  Also, those reading might think these concepts bear a striking resemblance to CRDT and join-semilattice, and they would be correct.  This is a useful comparison to carry mentally when thinking about propagator networks.</p>
<p>Moving onto the code portion of the post, the below examples were created using <a href="https://www.microsoft.com/net/download/core" target="_blank" rel="noopener">.NET Core</a> 3.1.  As a caveat, this is an experimental project.  I’m using it to research several concepts surrounding propagator networks.  So it is functional, but not currently production ready.  Beyond internal implementation choices I’m playing with the semantics and library ergonomics.  As a result, the code you see below will certainly shift over time.  This doesn’t change the underlying concepts of propagator networks.  The library is available below. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new package propagator --version 0.1.0</span><br></pre></td></tr></table></figure>
<h2 id="Temperature-Conversion"><a href="#Temperature-Conversion" class="headerlink" title="Temperature Conversion"></a>Temperature Conversion</h2><p>I want to pull a couple examples from the previously mentioned papers to walk through the process. First is a temperature conversion example.  The math on this is so simple that using propagators can feel like overkill, but the simplicity allows focus on the propagator mechanics without getting too caught up in complex formulas.  Even with simple formulas, don’t underestimate the ability to define mathematical relationships once.</p>
<p>Building a propagator network is a multiple step process.  Starting with the temperature conversion formula <code>F = C * 1.8 + 32</code>, there are several components and operations to be codified.  But before getting into the details, a diagram assists in conceptualization of the entire formula and how the it is broken down.</p>
<p><img src="/images/prop1/temperature-network.png" alt="Temperature Converter"></p>
<p>First, cells need to be created to hold data.  There are the two end points (Celsius and Fahrenheit) that will serve as input or output, depending on conversion direction.  There are also constants in the formula (1.8 and 32).  Additionally, and perhaps less obvious at first glance, there are sub-results for the intermediate operations within the formula (C * 1.8).  When the function is initially created the only values known are the ones sent in (C or F) and the constants.  Beyond that, everything else is uninitialized.  </p>
<p>Second, the relationships between the cells need to be defined, these are the propagators.  Conveniently, the library has built-in propagators to support common math operations.  A multiplier propagator will represent the <code>C * 1.8 = C18</code> sub-component.  An adder propagator will then take that sub-result and combine it for a final result <code>C18 + 32 = F</code>.  These propagators are all that is needed to wire things together.</p>
<p>With the network in place, all that is needed now is to set the input and run the network.  Since this is meant to work in either direction, it will accept and return both Celsius and Fahrenheit values.  Below is the implementation.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// TemperatureConverter</span></span><br><span class="line"><span class="comment">/// F = C * 1.8 + 32 </span></span><br><span class="line"><span class="keyword">let</span> temperatureConverter (c: float option) (f: float option) =</span><br><span class="line">  <span class="keyword">let</span> network = PropagatorNetwork()</span><br><span class="line">  <span class="keyword">let</span> cellc = network.AddCell c</span><br><span class="line">  <span class="keyword">let</span> cell18 = network.AddConstant <span class="number">1.8</span></span><br><span class="line">  <span class="keyword">let</span> cellc18 = network.AddCell None</span><br><span class="line">  <span class="keyword">let</span> cell32 = network.AddConstant <span class="number">32.</span></span><br><span class="line">  <span class="keyword">let</span> cellf = network.AddCell f</span><br><span class="line">  </span><br><span class="line">  multiplier cellc cell18 cellc18 |&gt; network.AddPropagator</span><br><span class="line">  adder cellc18 cell32 cellf |&gt; network.AddPropagator</span><br><span class="line"></span><br><span class="line">  network.Run()</span><br><span class="line">  (network.GetFloat cellc, network.GetFloat cellf)</span><br></pre></td></tr></table></figure>
<p>With the Celsius/Fahrenheit relationship defined, I can now call conversions in either direction.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C -&gt; F</span></span><br><span class="line"><span class="keyword">match</span> (temperatureConverter (Some <span class="number">20.</span>) None) <span class="keyword">with</span></span><br><span class="line">| Some(c), Some(f) -&gt; printfn <span class="string">"%5.2fc = %5.2ff"</span> c f</span><br><span class="line">| _ -&gt; printfn <span class="string">"Conversion undetermined"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// F -&gt; C</span></span><br><span class="line"><span class="keyword">match</span> (temperatureConverter None (Some <span class="number">80.</span>)) <span class="keyword">with</span></span><br><span class="line">| Some(c), Some(f) -&gt; printfn <span class="string">"%5.2fc = %5.2ff"</span> c f</span><br><span class="line">| _ -&gt; printfn <span class="string">"Conversion undetermined"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"><span class="number">20.00</span>c = <span class="number">68.00</span>f</span><br><span class="line"><span class="number">26.67</span>c = <span class="number">80.00</span>f</span><br></pre></td></tr></table></figure>
<p>Just for kicks I can easily add capability.  The propagator network can be expanded to support Kelvin.  By adding a single propagator for a <code>C = K - 273.15</code> conversion, the network now supports conversions between all three systems in any direction. </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> temperatureConverterCFK (c: float option) (f: float option) (k: float option) =</span><br><span class="line">  <span class="keyword">let</span> network = PropagatorNetwork()</span><br><span class="line">  <span class="keyword">let</span> cellc = network.AddCell c</span><br><span class="line">  <span class="keyword">let</span> cell18 = network.AddConstant <span class="number">1.8</span></span><br><span class="line">  <span class="keyword">let</span> cellc18 = network.AddCell None</span><br><span class="line">  <span class="keyword">let</span> cell32 = network.AddConstant <span class="number">32.</span></span><br><span class="line">  <span class="keyword">let</span> cellf = network.AddCell f</span><br><span class="line">  <span class="keyword">let</span> cellk = network.AddCell k</span><br><span class="line">  <span class="keyword">let</span> cell27315 = network.AddConstant <span class="number">273.15</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// F = C × 1.8 + 32 </span></span><br><span class="line">  multiplier cellc cell18 cellc18 |&gt; network.AddPropagator</span><br><span class="line">  adder cellc18 cell32 cellf |&gt; network.AddPropagator</span><br><span class="line">  <span class="comment">// C = K - 273.15</span></span><br><span class="line">  subtracter cellk cell27315 cellc |&gt; network.AddPropagator</span><br><span class="line"></span><br><span class="line">  network.Run()</span><br><span class="line">  (network.GetFloat cellc, network.GetFloat cellf, network.GetFloat cellk)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Kelvin conversions</span></span><br><span class="line">[ (Some <span class="number">20.</span>, None, None)</span><br><span class="line">  (None, Some <span class="number">80.</span>, None)</span><br><span class="line">  (None, None, Some <span class="number">200.</span>) ]</span><br><span class="line">|&gt; List.iter(<span class="keyword">fun</span> (c, f, k) -&gt;</span><br><span class="line">  <span class="keyword">match</span> (temperatureConverterCFK c f k) <span class="keyword">with</span></span><br><span class="line">  | Some(c), Some(f), Some(k) -&gt; printfn <span class="string">"%6.2fc = %6.2ff = %6.2fk"</span> c f k</span><br><span class="line">  | _ -&gt; printfn <span class="string">"Conversion undetermined"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"> <span class="number">20.00</span>c =  <span class="number">68.00</span>f = <span class="number">293.15</span>k</span><br><span class="line"> <span class="number">26.67</span>c =  <span class="number">80.00</span>f = <span class="number">299.82</span>k</span><br><span class="line"><span class="number">-73.15</span>c = <span class="number">-99.67</span>f = <span class="number">200.00</span>k</span><br></pre></td></tr></table></figure>
<h2 id="Estimating-Building-Height"><a href="#Estimating-Building-Height" class="headerlink" title="Estimating Building Height"></a>Estimating Building Height</h2><p>Moving beyond relatively simple conversions, there are more complicated data relationships that can be represented using propagator networks.  That leads to the second example, estimating the height of a building.  It specifically addresses the idea of imperfect information and how multiple sources of truth can improve the overall quality of knowledge.  Again, this is an example pulled from the reference papers.  It isn’t exact clone though, I provide a slightly different twist to show additional dynamics.</p>
<p>For the resourceful person, there is more than one way to estimate the height of a building.  Assuming I have a barometer at my disposal, I have encoded three possible methods below.  First, I can drop an object from the top of the building and time how long it takes to hit the ground.  The associated formula is <code>height = 0.5 * g * t^2</code>.  Second, leveraging the knowledge of similar triangles, I can measure the height and shadow of a small object setting beside the building as well as the building’s shadow. The associated formula is <code>buildingHeight / buildingShadow = smallHeight / smallShadow</code>.  Third, I can count the rows of windows and estimate the height of a floor.  The associated formula is <code>height = floors * floorHeight</code>.  These are all reasonable, but imprecise, estimation methods.  We’ll also find that the total is better than the sum of all parts.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Height - using fall duration and shadow length and floor count</span></span><br><span class="line"><span class="keyword">let</span> buildingHeight (fallTime: Interval option) (buildingShadow: Interval option) (barometerHeight: Interval option) (barometerShadow: Interval option) (floors: Interval option) (floorHeight: Interval option) =</span><br><span class="line">  <span class="keyword">let</span> buildingHeight = None</span><br><span class="line">  <span class="keyword">let</span> network = PropagatorNetwork()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Height based on fall time</span></span><br><span class="line">  <span class="comment">// Fall duration: d = 0.5 * g * t^2</span></span><br><span class="line">  <span class="keyword">let</span> fallTime = network.AddCell fallTime</span><br><span class="line">  <span class="keyword">let</span> two = network.AddConstant &#123; Interval.Min = Some <span class="number">2.</span>; Max = Some <span class="number">2.</span>&#125;</span><br><span class="line">  <span class="keyword">let</span> t2 = network.AddCell None</span><br><span class="line">  <span class="keyword">let</span> g = network.AddConstant &#123; Interval.Min = Some <span class="number">9.80665</span>; Max = Some <span class="number">9.80665</span> &#125;</span><br><span class="line">  <span class="keyword">let</span> gt2 = network.AddCell None</span><br><span class="line">  <span class="keyword">let</span> half = network.AddConstant &#123; Interval.Min = Some <span class="number">0.5</span>; Max = Some <span class="number">0.5</span> &#125;</span><br><span class="line">  <span class="keyword">let</span> buildingHeight = network.AddCell buildingHeight</span><br><span class="line">  </span><br><span class="line">  power fallTime two t2 |&gt; network.AddPropagator</span><br><span class="line">  multiplier g t2 gt2 |&gt; network.AddPropagator</span><br><span class="line">  multiplier half gt2 buildingHeight |&gt; network.AddPropagator</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Shadow</span></span><br><span class="line">  <span class="comment">// Similar triangles Shadow Ratio = Height / Shadow</span></span><br><span class="line">  <span class="keyword">let</span> barometerHeight = network.AddCell barometerHeight</span><br><span class="line">  <span class="keyword">let</span> barometerShadow = network.AddCell barometerShadow</span><br><span class="line">  <span class="keyword">let</span> buildingShadow = network.AddCell buildingShadow</span><br><span class="line">  <span class="keyword">let</span> shadowRatio = network.AddCell None</span><br><span class="line"></span><br><span class="line">  divider barometerHeight barometerShadow shadowRatio |&gt; network.AddPropagator</span><br><span class="line">  divider buildingHeight buildingShadow shadowRatio |&gt; network.AddPropagator</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Floors</span></span><br><span class="line">  <span class="keyword">let</span> floorCount = network.AddCell floors</span><br><span class="line">  <span class="keyword">let</span> floorHeight = network.AddCell floorHeight</span><br><span class="line">  </span><br><span class="line">  multiplier floorHeight floorCount buildingHeight |&gt; network.AddPropagator</span><br><span class="line"></span><br><span class="line">  network.Run()</span><br><span class="line">  </span><br><span class="line">  (network.GetInterval fallTime, network.GetInterval buildingHeight, network.GetInterval buildingShadow, network.GetInterval floorCount, network.GetInterval floorHeight)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Create an in interval type</span></span><br><span class="line"><span class="keyword">let</span> interval (min: float option) (max: float option) =</span><br><span class="line">  Some &#123; Interval.Min = min; Max = max &#125;</span><br></pre></td></tr></table></figure>
<p>One thing about imprecise measurements is the need for a datatype that supports values with a margin of error.  Enter Interval, a built-in propagator library type.  Instead of using <code>float</code> for building height estimates, <code>Interval</code> provides a range of possible values per each measurement method.  This facilitates the storing of imperfect information.</p>
<p>In the first scenario, I have a barometer. I decide to drop the barometer from the top of the building and measure how long it takes to hit the ground.  Frankly this feels like a destructive method of measurement, but desperate times…  When measured, it takes about 4 seconds. But given that there is a natural delay when I start and stop the stopwatch, I assume I have a one second margin of error.  This translates to a possible interval of between 3.5 and 4.5 seconds.  With this knowledge I can feed that information in the <code>buildingHeight</code> function and find that the building is between 60 and 99 meters high.  The function supports additional inputs, but since I don’t have additional information those parts of the propagator network are non-impacting.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fallTime = interval (Some <span class="number">3.5</span>) (Some <span class="number">4.5</span>)</span><br><span class="line"><span class="keyword">let</span> (_, height', _, _, _) = buildingHeight fallTime None None None None None</span><br><span class="line">printfn <span class="string">"Only fall time...                Height (m): %O"</span> height'</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result: </span></span><br><span class="line">Only fall time...                Height (m): Some([<span class="number">60.06573</span> .. <span class="number">99.29233</span>])</span><br></pre></td></tr></table></figure>
<p>In the second scenario I use the knowledge of similar triangles and ratios.  I can place the barometer on the ground beside the building and measure it’s shadow.  Since the sun’s angle is similar for the barometer and building, I can use that information along with the length of the building’s shadow to gain an estimate of the building’s height.  After some measurements it is determined that the barometer’s height and shadow are about 12.5cm and 24.5cm.  The building’s shadow is about 170.5m long.  Providing this additional information into the function I get a better estimate of the building’s height of between 81 and 92 meters high.  It looks like I’m making progress.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> buildingShadow = interval (Some <span class="number">170.0</span>) (Some <span class="number">171.0</span>)</span><br><span class="line"><span class="keyword">let</span> barometerHeight = interval (Some <span class="number">0.12</span>) (Some <span class="number">0.13</span>)</span><br><span class="line"><span class="keyword">let</span> barometerShadow = interval (Some <span class="number">0.24</span>) (Some <span class="number">0.25</span>)</span><br><span class="line"><span class="keyword">let</span> (_, height', _, _, _) = buildingHeight fallTime buildingShadow barometerHeight barometerShadow None None </span><br><span class="line">printfn <span class="string">"Fall time and shadow...          Height (m): %O"</span> height'</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result: </span></span><br><span class="line">Fall time <span class="keyword">and</span> shadow...          Height (m): Some([<span class="number">81.6</span> .. <span class="number">92.625</span>])</span><br></pre></td></tr></table></figure>
<p>In the third scenario I can improve the estimate even more. I count the windows on the outside and determine it has 30 floors. I can also make an educated guess that each floor is about 3-3.5 meters high.  Using this third piece of information I can enhance the building’s height estimate even more to 90 to 92 meters high.  The power of multiple sources is magnified.  Using three different sources, all with their own margin of error, I can easily aggregate the results to reduce the overall margin of error.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> floors = interval (Some <span class="number">30.</span>) (Some <span class="number">30.</span>)</span><br><span class="line"><span class="keyword">let</span> floorHeight = interval (Some <span class="number">3.</span>) (Some <span class="number">3.5</span>)</span><br><span class="line"><span class="keyword">let</span> (_, height', _, _, _) = buildingHeight fallTime buildingShadow barometerHeight barometerShadow floors floorHeight</span><br><span class="line">printfn <span class="string">"Fall time, shadow, and floors... Height (m): %O"</span> height'</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result:</span></span><br><span class="line">Fall time, shadow, <span class="keyword">and</span> floors... Height (m): Some([<span class="number">90</span> .. <span class="number">92.625</span>])</span><br></pre></td></tr></table></figure>
<p>Stepping back, it helps to visualize in more detail how these intervals work together.  Below are the results of each piece of knowledge by itself.  They all have varying amounts of accuracy, but as additional information is added to the model, the final estimate is improved.  </p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Separate results:</span></span><br><span class="line">Only fall time...                Height (m): Some([<span class="number">60.06573</span> .. <span class="number">99.29233</span>])</span><br><span class="line">Only shadow...                   Height (m): Some([<span class="number">81.6</span> .. <span class="number">92.625</span>])</span><br><span class="line">Only floors...                   Height (m): Some([<span class="number">90</span> .. <span class="number">105</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Aggregated result:</span></span><br><span class="line">Fall time, shadow, <span class="keyword">and</span> floors... Height (m): Some([<span class="number">90</span> .. <span class="number">92.625</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/images/prop1/aggregated-intervals.png" alt="Aggregated Intervals"></p>
<p>As a side note, this model contains the same type of dynamic relationships as the temperature conversion model.  Data flows in all directions.  Lets say for example I don’t feel good about a mental estimate of floor height, but I can still count windows.  If I run the function and exclude my floorHeight measurement, I won’t get a better building height estimate, but I can get an additional estimate that the floor height is between 2.7 and 3.1 meters.  With respect to knowledge aggregation, this is a nice attribute of propagator network models.</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (_, height', _, _, floorHeight') = buildingHeight fallTime buildingShadow barometerHeight barometerShadow floors None</span><br><span class="line">printfn <span class="string">"Building Height (m): %O"</span> height'</span><br><span class="line">printfn <span class="string">"Floor Height (m)   : %O"</span> floorHeight'</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result:</span></span><br><span class="line">Building Height (m): Some([<span class="number">81.6</span> .. <span class="number">92.625</span>])</span><br><span class="line">Floor Height (m)   : Some([<span class="number">2.72</span> .. <span class="number">3.0875</span>])</span><br></pre></td></tr></table></figure>
<p>These two examples provide some insight into the dynamics of propagator networks.  I could go on, but I think this is a good break point.  As an introduction to the concept of propagator networks, I hope you’ve found this computation approach interesting.  If you want to dig in a bit more, additional references are below.  Until next time.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References "></a>References <a name="references"></a></h2><ul>
<li><a href="/images/prop1/the_art_of_the_propagator.pdf">The Art of the Propagator</a></li>
<li><a href="/images/prop1/propagation_networks_thesis.pdf">Propagator Networks Thesis</a></li>
</ul>

        <div class="related-posts-box">
        Related Posts:<ul class="related-posts"><li class="related-posts-item"><a class="related-posts-link" href="/2020/11/29/Mqtt-Server-FSharp-2/">Building an MQTT server in F# - Part 2</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2018/04/24/FSharp-and-Word-Stems/">F# and Word Stems</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2024/11/27/Estimated-Shortest-Path-F/">Estimated Shortest Path with F#</a></li></ul>        </div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://codesuji.com/2020/05/10/Propagator-Networks-in-F/" data-id="clg8exofm00csw5mw7pv68hrc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/F/">F#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FSharp/">FSharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Propagator/">Propagator</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/10/19/Microbit-Introduction/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Playing with the micro:bit
        
      </div>
    </a>
  
  
    <a href="/2020/04/25/Web-Scraping-with-F/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Web Scraping with F#</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Core/" style="font-size: 17px;">.NET Core</a> <a href="/tags/Accord-NET/" style="font-size: 15px;">Accord.NET</a> <a href="/tags/Algorithms/" style="font-size: 16px;">Algorithms</a> <a href="/tags/Analytics/" style="font-size: 14px;">Analytics</a> <a href="/tags/Audio/" style="font-size: 10px;">Audio</a> <a href="/tags/Benchmarking/" style="font-size: 12px;">Benchmarking</a> <a href="/tags/Chiron/" style="font-size: 10px;">Chiron</a> <a href="/tags/Classification/" style="font-size: 11px;">Classification</a> <a href="/tags/Cognitive-Services/" style="font-size: 11px;">Cognitive Services</a> <a href="/tags/Compiler/" style="font-size: 13px;">Compiler</a> <a href="/tags/Computer-Vision/" style="font-size: 11px;">Computer Vision</a> <a href="/tags/Cordova/" style="font-size: 10px;">Cordova</a> <a href="/tags/DTW/" style="font-size: 14px;">DTW</a> <a href="/tags/Data/" style="font-size: 18px;">Data</a> <a href="/tags/Database/" style="font-size: 13px;">Database</a> <a href="/tags/Decision-Trees/" style="font-size: 11px;">Decision Trees</a> <a href="/tags/Deedle/" style="font-size: 10px;">Deedle</a> <a href="/tags/Delegate/" style="font-size: 10px;">Delegate</a> <a href="/tags/Detection/" style="font-size: 10px;">Detection</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Dynamic-Time-Warping/" style="font-size: 13px;">Dynamic Time Warping</a> <a href="/tags/EEG/" style="font-size: 10px;">EEG</a> <a href="/tags/Edges/" style="font-size: 10px;">Edges</a> <a href="/tags/Education/" style="font-size: 10px;">Education</a> <a href="/tags/Elmish/" style="font-size: 10px;">Elmish</a> <a href="/tags/EmguCV/" style="font-size: 10px;">EmguCV</a> <a href="/tags/Entropy/" style="font-size: 10px;">Entropy</a> <a href="/tags/F/" style="font-size: 20px;">F#</a> <a href="/tags/FParsec/" style="font-size: 12px;">FParsec</a> <a href="/tags/FSAdvent/" style="font-size: 10px;">FSAdvent</a> <a href="/tags/FSharp/" style="font-size: 20px;">FSharp</a> <a href="/tags/Fable/" style="font-size: 10px;">Fable</a> <a href="/tags/Faces/" style="font-size: 11px;">Faces</a> <a href="/tags/Filters/" style="font-size: 10px;">Filters</a> <a href="/tags/Http/" style="font-size: 11px;">Http</a> <a href="/tags/Images/" style="font-size: 12px;">Images</a> <a href="/tags/Ionide/" style="font-size: 10px;">Ionide</a> <a href="/tags/Kaggle/" style="font-size: 12px;">Kaggle</a> <a href="/tags/Keyboard/" style="font-size: 13px;">Keyboard</a> <a href="/tags/Legos/" style="font-size: 11px;">Legos</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/MLNet/" style="font-size: 16px;">MLNet</a> <a href="/tags/MSIL/" style="font-size: 12px;">MSIL</a> <a href="/tags/Machine-Learning/" style="font-size: 19px;">Machine Learning</a> <a href="/tags/MathNet/" style="font-size: 10px;">MathNet</a> <a href="/tags/Messaging/" style="font-size: 10px;">Messaging</a> <a href="/tags/Mobile/" style="font-size: 10px;">Mobile</a> <a href="/tags/Mono/" style="font-size: 10px;">Mono</a> <a href="/tags/Morse-Code/" style="font-size: 10px;">Morse Code</a> <a href="/tags/Mqtt/" style="font-size: 12px;">Mqtt</a> <a href="/tags/Nix/" style="font-size: 10px;">Nix</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/Parsing/" style="font-size: 12px;">Parsing</a> <a href="/tags/Performance/" style="font-size: 13px;">Performance</a> <a href="/tags/Presentations/" style="font-size: 10px;">Presentations</a> <a href="/tags/Propagator/" style="font-size: 10px;">Propagator</a> <a href="/tags/Racket/" style="font-size: 10px;">Racket</a> <a href="/tags/Regression/" style="font-size: 10px;">Regression</a> <a href="/tags/Rekognition/" style="font-size: 10px;">Rekognition</a> <a href="/tags/Robotics/" style="font-size: 10px;">Robotics</a> <a href="/tags/Rust/" style="font-size: 10px;">Rust</a> <a href="/tags/STEM/" style="font-size: 11px;">STEM</a> <a href="/tags/Scoring/" style="font-size: 10px;">Scoring</a> <a href="/tags/Search/" style="font-size: 11px;">Search</a> <a href="/tags/Serialization/" style="font-size: 10px;">Serialization</a> <a href="/tags/SignalR/" style="font-size: 10px;">SignalR</a> <a href="/tags/Signals/" style="font-size: 13px;">Signals</a> <a href="/tags/Similarity/" style="font-size: 11px;">Similarity</a> <a href="/tags/Sound/" style="font-size: 10px;">Sound</a> <a href="/tags/Statistics/" style="font-size: 13px;">Statistics</a> <a href="/tags/Text/" style="font-size: 14px;">Text</a> <a href="/tags/Timeseries/" style="font-size: 11px;">Timeseries</a> <a href="/tags/Tips/" style="font-size: 13px;">Tips</a> <a href="/tags/Tools/" style="font-size: 10px;">Tools</a> <a href="/tags/Translation/" style="font-size: 10px;">Translation</a> <a href="/tags/Types/" style="font-size: 10px;">Types</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Web/" style="font-size: 11px;">Web</a> <a href="/tags/Webapi/" style="font-size: 11px;">Webapi</a> <a href="/tags/admin/" style="font-size: 11px;">admin</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/11/27/Estimated-Shortest-Path-F/">Estimated Shortest Path with F#</a>
          </li>
        
          <li>
            <a href="/2024/05/24/Distinct-Counting-in-F/">Estimating Distinct Element Counts with F#</a>
          </li>
        
          <li>
            <a href="/2024/05/21/F-and-Anthropic/">Harnessing the Anthropic API with F#</a>
          </li>
        
          <li>
            <a href="/2023/09/23/F-Flurl/">Using F# and Flurl</a>
          </li>
        
          <li>
            <a href="/2023/04/08/VectorSearch-F-1/">Vector Search using F#</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 codesuji.com<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>